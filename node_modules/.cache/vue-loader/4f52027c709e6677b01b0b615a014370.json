{"remainingRequest":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuhao/TIMSDK/H5/src/components/conversation/conversation-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuhao/TIMSDK/H5/src/components/conversation/conversation-list.vue","mtime":1616982605596},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ConversationItem from './conversation-item'\nimport { mapState } from 'vuex'\nexport default {\n  name: 'ConversationList',\n  components: { ConversationItem },\n  data() {\n    return {\n      showDialog: false,\n      userID: '',\n      isCheckouting: false, // 是否正在切换会话\n      timeout: null\n    }\n  },\n  computed: {\n    ...mapState({\n      conversationList: state => state.conversation.conversationList,\n      currentConversation: state => state.conversation.currentConversation\n    })\n  },\n  mounted() {\n    window.addEventListener('keydown', this.handleKeydown)\n  },\n  destroyed() {\n    window.removeEventListener('keydown', this.handleKeydown)\n  },\n  methods: {\n    handleRefresh() {\n      this.refreshConversation()()\n    },\n    refreshConversation() {\n      let that = this\n      return function () {\n        if (!that.timeout) {\n          that.timeout = setTimeout(() =>{\n            that.timeout = null\n            that.tim.getConversationList().then(() => {\n              that.$store.commit('showMessage', {\n                message: '刷新成功',\n                type: 'success'\n              })\n            })\n          }, 1000)\n        }\n      }\n    },\n    handleAddButtonClick() {\n      this.showDialog = true\n    },\n    handleConfirm() {\n      if (this.userID !== '@TIM#SYSTEM') {\n        this.$store\n          .dispatch('checkoutConversation', `C2C${this.userID}`)\n          .then(() => {\n            this.showDialog = false\n          }).catch(() => {\n          this.$store.commit('showMessage', {\n            message: '没有找到该用户',\n            type: 'warning'\n          })\n        })\n      } else {\n        this.$store.commit('showMessage', {\n          message: '没有找到该用户',\n          type: 'warning'\n        })\n      }\n      this.userID = ''\n    },\n    handleKeydown(event) {\n      if (event.keyCode !== 38 && event.keyCode !== 40 || this.isCheckouting) {\n        return\n      }\n      const currentIndex = this.conversationList.findIndex(\n        item => item.conversationID === this.currentConversation.conversationID\n      )\n      if (event.keyCode === 38 && currentIndex - 1 >= 0) {\n        this.checkoutPrev(currentIndex)\n      }\n      if (\n        event.keyCode === 40 &&\n        currentIndex + 1 < this.conversationList.length\n      ) {\n        this.checkoutNext(currentIndex)\n      }\n    },\n    checkoutPrev(currentIndex) {\n      this.isCheckouting = true\n      this.$store\n        .dispatch(\n          'checkoutConversation',\n          this.conversationList[currentIndex - 1].conversationID\n        )\n        .then(() => {\n          this.isCheckouting = false\n        })\n        .catch(() => {\n          this.isCheckouting = false\n        })\n    },\n    checkoutNext(currentIndex) {\n      this.isCheckouting = true\n      this.$store\n        .dispatch(\n          'checkoutConversation',\n          this.conversationList[currentIndex + 1].conversationID\n        )\n        .then(() => {\n          this.isCheckouting = false\n        })\n        .catch(() => {\n          this.isCheckouting = false\n        })\n    }\n  }\n}\n",null]}