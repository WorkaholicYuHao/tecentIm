{"remainingRequest":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuhao/TIMSDK/H5/src/components/message/message-bubble.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuhao/TIMSDK/H5/src/components/message/message-bubble.vue","mtime":1616982605602},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n  name: 'MessageBubble',\n  data() {\n    return {\n      isTimeout: false\n    }\n  },\n  props: {\n    isMine: {\n      type: Boolean\n    },\n    isNew: {\n      type: Boolean\n    },\n    message: {\n      type: Object,\n      required: true\n    }\n  },\n  created() {\n    this.isTimeoutHandler()\n  },\n  mounted() {\n    if (this.$refs.dropdown && this.$refs.dropdown.$el) {\n      this.$refs.dropdown.$el.addEventListener('mousedown', this.handleDropDownMousedown)\n    }\n  },\n  beforeDestroy() {\n    if (this.$refs.dropdown && this.$refs.dropdown.$el) {\n      this.$refs.dropdown.$el.removeEventListener('mousedown', this.handleDropDownMousedown)\n    }\n  },\n  computed: {\n    bubbleStyle() {\n      let classString = ''\n      if (this.isMine) {\n        classString += 'message-send'\n      } else {\n        classString += 'message-received'\n      }\n      if (this.isNew) {\n        classString += 'new'\n      }\n      return classString\n    },\n    text() {\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && !this.isMine) {\n        return '对方撤回了一条消息'\n      }\n      if (this.message.conversationType === this.TIM.TYPES.CONV_GROUP && !this.isMine) {\n        return `${this.message.from}撤回了一条消息`\n      }\n      return '你撤回了一条消息'\n    },\n    messageReadByPeer() {\n      if (this.message.status !== 'success') {\n        return false\n      }\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && this.message.isPeerRead) {\n        return '已读'\n      }\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && !this.message.isPeerRead) {\n        return '未读'\n      }\n      return ''\n    },\n    isEdit() {\n      if (!this.isMine) {\n        return false\n      }\n      if (this.message.type !== this.TIM.TYPES.MSG_TEXT) {\n        return false\n      }\n      if (this.isTimeout) {\n        return false\n      }\n      return true\n    },\n  },\n  methods: {\n    handleDropDownMousedown(e) {\n      if (!this.isMine || this.isTimeout) {\n        return\n      }\n      if (e.buttons === 2) {\n        if (this.$refs.dropdown.visible) {\n          this.$refs.dropdown.hide()\n        } else {\n          this.$refs.dropdown.show()\n        }\n      }\n    },\n    handleCommand(command) {\n      switch (command) {\n        case 'revoke':\n          this.tim.revokeMessage(this.message).then(() => {\n            this.isTimeoutHandler()\n          }).catch((err) => {\n            this.$store.commit('showMessage', {\n              message: err,\n              type: 'warning'\n            })\n          })\n          break\n        case 'delete':\n          break\n        default:\n          break\n      }\n    },\n    isTimeoutHandler() { // 从发送消息时间开始算起，两分钟内可以编辑\n      let now = new Date()\n      if (parseInt(now.getTime() / 1000) - this.message.time > 2 * 60) {\n        this.isTimeout = true\n        return\n      }\n      setTimeout(this.isTimeoutHandler, 1000)\n    },\n    reEdit() {\n      this.$bus.$emit('reEditMessage', this.message.payload.text)\n    }\n  }\n}\n",null]}