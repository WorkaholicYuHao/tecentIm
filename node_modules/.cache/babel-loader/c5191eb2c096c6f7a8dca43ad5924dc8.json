{"remainingRequest":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js!/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuhao/TIMSDK/H5/src/components/message/trtc-calling/calling-index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuhao/TIMSDK/H5/src/components/message/trtc-calling/calling-index.vue","mtime":1616982605605},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/yuhao/TIMSDK/H5/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _defineProperty from \"/Users/yuhao/TIMSDK/H5/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapGetters, mapState } from 'vuex';\nimport { formatDuration } from \"../../../utils/formatDuration\";\nexport default {\n  name: 'CallLayer',\n  data: function data() {\n    return {\n      timeout: null,\n      callType: 1,\n      //1:audio，2:video\n      Trtc: undefined,\n      isCamOn: true,\n      isMicOn: true,\n      isInvitedMicOn: true,\n      maskShow: false,\n      isLocalMain: true,\n      // 本地视频是否是主屏幕显示\n      start: 0,\n      end: 0,\n      duration: 0,\n      hangUpTimer: 0,\n      // 通话计时id\n      ready: false,\n      dialling: false,\n      // 是否拨打电话中\n      calling: false,\n      // 是否通话中\n      isDialled: false,\n      // 是否被呼叫\n      inviteID: '',\n      inviteData: {},\n      sponsor: '',\n      //发起者\n      invitedUserID: [],\n      //被邀请者\n      invitedNick: '',\n      invitedUserInfo: [],\n      defaultAvatar: 'https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-3.png',\n      viewLocalDomID: '',\n      callingUserList: [],\n      // 参加通话的人 ,不包括自己\n      callingType: 'C2C',\n      //区分多人和C2C通话的UI样式\n      isStartLocalView: false,\n      //本地是否开启\n      callingTips: {\n        callEnd: 1,\n        //通话结束\n        callTimeout: 5\n      }\n    };\n  },\n  computed: _objectSpread(_objectSpread(_objectSpread({}, mapGetters(['toAccount', 'currentConversationType'])), mapState({\n    currentConversation: function currentConversation(state) {\n      return state.conversation.currentConversation;\n    },\n    currentUserProfile: function currentUserProfile(state) {\n      return state.user.currentUserProfile;\n    },\n    callingInfo: function callingInfo(state) {\n      return state.conversation.callingInfo;\n    },\n    userID: function userID(state) {\n      return state.user.userID;\n    },\n    userSig: function userSig(state) {\n      return state.user.userSig;\n    },\n    videoRoom: function videoRoom(state) {\n      return state.video.videoRoom;\n    },\n    sdkAppID: function sdkAppID(state) {\n      return state.user.sdkAppID;\n    }\n  })), {}, {\n    formatDurationStr: function formatDurationStr() {\n      return formatDuration(this.duration);\n    },\n    myAvatar: function myAvatar() {\n      return this.currentUserProfile.avatar || this.defaultAvatar;\n    },\n    myNick: function myNick() {\n      return this.currentUserProfile.nick || this.userID;\n    }\n  }),\n  created: function created() {\n    this.initListener();\n  },\n  watch: {\n    callingUserList: {\n      handler: function handler(newValue) {\n        var _this = this;\n\n        if (newValue.length < 2 && this.calling) {\n          //单人通话\n          this.$nextTick(function () {\n            var elementId = \"video-\".concat(newValue[0]);\n            var element = window.document.getElementById(elementId);\n            var local = window.document.getElementById('local');\n            var group_element = window.document.getElementById('small-group'); // element.addEventListener('click', this.changeMainVideo)\n            // local.addEventListener('click', this.changeMainVideo)\n\n            if (!element || !element.classList) {\n              return;\n            }\n\n            if (!local || !local.classList) {\n              return;\n            }\n\n            element && element.classList.remove('video-box');\n            local && local.classList.remove('video-box');\n            group_element && group_element.classList.add('small-group_box');\n            _this.isLocalMain ? element.classList.add('big') : element.classList.add('small');\n            _this.isLocalMain ? local.classList.add('small') : element.classList.add('big');\n          });\n          return;\n        }\n\n        if (newValue.length >= 2 && this.calling) {\n          var group_element = window.document.getElementById('small-group');\n          group_element && group_element.classList.remove('small-group_box');\n          var elements = window.document.getElementById('small-group').childNodes;\n          elements.forEach(function (item, index) {\n            if (index === 0) {\n              item.classList.remove('small');\n            }\n\n            item.classList.remove('big');\n            item.classList.add('video-box');\n          });\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  destroyed: function destroyed() {\n    var _this2 = this;\n\n    this.removeListener();\n    window.addEventListener('beforeunload', function () {\n      _this2.videoCallLogOut();\n    });\n    window.addEventListener('leave', function () {\n      _this2.videoCallLogOut();\n    });\n  },\n  mounted: function mounted() {\n    this.$bus.$on('video-call', this.videoCalling); // 发起通话\n\n    this.$bus.$on('audio-call', this.audioCalling); // 发起通话\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.$bus.$off('video-call', this.videoCalling);\n    this.$bus.$off('audio-call', this.audioCalling); // 发起通话\n  },\n  methods: {\n    videoCallLogOut: function videoCallLogOut() {\n      // 针对，刷新页面，关闭Tab，登出情况下，通话断开的逻辑\n      if (this.dialling || this.calling) {\n        this.leave();\n      }\n\n      if (this.isDialled) {\n        this.refuse();\n      }\n    },\n    initListener: function initListener() {\n      // sdk内部发生了错误\n      this.trtcCalling.on(this.TRTCCalling.EVENT.ERROR, this.handleError); // 被邀请进行通话\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.INVITED, this.handleNewInvitationReceived); // 有用户同意进入通话，那么会收到此回调\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.USER_ENTER, this.handleUserEnter); // 如果有用户同意离开通话，那么会收到此回调\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.USER_LEAVE, this.handleUserLeave); // 用户拒绝通话\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.REJECT, this.handleInviteeReject); //邀请方忙线\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.LINE_BUSY, this.handleInviteeLineBusy); // 作为被邀请方会收到，收到该回调说明本次通话被取消了\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.CALLING_CANCEL, this.handleInviterCancel); // 重复登陆，收到该回调说明被踢出房间\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.KICKED_OUT, this.handleKickedOut); // 作为邀请方会收到，收到该回调说明本次通话超时未应答\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.CALLING_TIMEOUT, this.handleCallTimeout); // 邀请用户无应答\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.NO_RESP, this.handleNoResponse); // 收到该回调说明本次通话结束了\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.CALLING_END, this.handleCallEnd); // 远端用户开启/关闭了摄像头, 会收到该回调\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.USER_VIDEO_AVAILABLE, this.handleUserVideoChange); // 远端用户开启/关闭了麦克风, 会收到该回调\n\n      this.trtcCalling.on(this.TRTCCalling.EVENT.USER_AUDIO_AVAILABLE, this.handleUserAudioChange);\n    },\n    removeListener: function removeListener() {\n      this.trtcCalling.off(this.TRTCCalling.EVENT.ERROR, this.handleError);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.INVITED, this.handleNewInvitationReceived);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.USER_ENTER, this.handleUserEnter);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.USER_LEAVE, this.handleUserLeave);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.REJECT, this.handleInviteeReject);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.LINE_BUSY, this.handleInviteeLineBusy);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.CALLING_CANCEL, this.handleInviterCancel);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.KICKED_OUT, this.handleKickedOut);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.CALLING_TIMEOUT, this.handleCallTimeout);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.NO_RESP, this.handleNoResponse);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.CALLING_END, this.handleCallEnd);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.USER_VIDEO_AVAILABLE, this.handleUserVideoChange);\n      this.trtcCalling.off(this.TRTCCalling.EVENT.USER_AUDIO_AVAILABLE, this.handleUserAudioChange);\n    },\n    handleError: function handleError() {},\n    // 被呼叫  接听方\n    handleNewInvitationReceived: function () {\n      var _handleNewInvitationReceived = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(payload) {\n        var inviteID, sponsor, inviteData, userIDList, isGroupCall;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                inviteID = payload.inviteID, sponsor = payload.sponsor, inviteData = payload.inviteData, userIDList = payload.userIDList, isGroupCall = payload.isGroupCall;\n                this.inviteID = inviteID;\n                this.inviteData = inviteData;\n                this.callType = inviteData.callType;\n                this.sponsor = sponsor;\n                this.invitedUserID = JSON.parse(JSON.stringify(userIDList)); //被邀请者\n\n                this.callingInfo.type = isGroupCall ? this.TIM.TYPES.CONV_GROUP : this.TIM.TYPES.CONV_C2C;\n                this.changeState('isDialled', true);\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function handleNewInvitationReceived(_x) {\n        return _handleNewInvitationReceived.apply(this, arguments);\n      }\n\n      return handleNewInvitationReceived;\n    }(),\n    accept: function accept() {\n      var _this3 = this;\n\n      this.trtcCalling.accept({\n        inviteID: this.inviteID,\n        roomID: this.inviteData.roomID,\n        callType: this.inviteData.callType\n      }).then(function (res) {\n        // this.callType = this.inviteData.callType\n        _this3.changeState('calling', true);\n\n        res.data.message.nick = _this3.currentUserProfile.nick;\n\n        _this3.$store.commit('pushCurrentMessageList', res.data.message);\n      });\n    },\n    reject: function reject() {\n      var _this4 = this;\n\n      var callType = this.inviteData.callType;\n      this.trtcCalling.reject({\n        inviteID: this.inviteID,\n        isBusy: false,\n        callType: callType\n      }).then(function (res) {\n        res.data.message.nick = _this4.currentUserProfile.nick;\n\n        _this4.$store.commit('pushCurrentMessageList', res.data.message);\n      });\n    },\n    handleDebounce: function handleDebounce(func, wait) {\n      var context = this;\n      var args = arguments;\n      if (this.timeout) clearTimeout(this.timeout);\n      this.timeout = setTimeout(function () {\n        func.apply(context, args);\n      }, wait);\n    },\n    // 双方建立连接\n    handleUserEnter: function handleUserEnter(_ref) {\n      var _this5 = this;\n\n      var userID = _ref.userID;\n      this.changeState('dialling', true);\n      this.isAccept(); // 判断是否为多人通话\n\n      if (this.callingUserList.length >= 2) {\n        this.callingType = this.TIM.TYPES.CONV_GROUP;\n      }\n\n      if (this.callingUserList.indexOf(userID) === -1) {\n        if (this.callType === this.TRTCCalling.CALL_TYPE.AUDIO_CALL) {\n          this.getUserAvatar(userID);\n        } else {\n          this.callingUserList.push(userID);\n        }\n      }\n\n      if (this.callType === this.TRTCCalling.CALL_TYPE.VIDEO_CALL) {\n        this.$nextTick(function () {\n          if (!_this5.isStartLocalView) {\n            _this5.startLocalView(); //本地只开启一次\n\n          }\n\n          _this5.startRemoteView(userID); //远端多次拉流\n\n        });\n      }\n    },\n    // 通话已建立\n    handleUserLeave: function handleUserLeave(_ref2) {\n      var userID = _ref2.userID;\n\n      if (this.callType === this.TRTCCalling.CALL_TYPE.AUDIO_CALL) {\n        // 语音通话\n        var _index = this.invitedUserInfo.findIndex(function (item) {\n          return item.userID === userID;\n        });\n\n        if (_index >= 0) {\n          this.invitedUserInfo.splice(_index, 1);\n        }\n\n        return;\n      }\n\n      var index = this.callingUserList.findIndex(function (item) {\n        return item === userID;\n      });\n\n      if (index >= 0) {\n        this.callingUserList.splice(index, 1);\n      }\n    },\n    // 通知呼叫方，未接通\n    //userID:invitee(被邀请者）\n    handleInviteeReject: function handleInviteeReject(_ref3) {\n      var userID = _ref3.userID;\n\n      if (this.userID === this.sponsor) {\n        // 发起者\n        this.setCallingstatus(userID);\n        this.$store.commit('showMessage', {\n          message: \"\".concat(userID, \"\\u62D2\\u7EDD\\u901A\\u8BDD\")\n        });\n      }\n    },\n    setCallingstatus: function setCallingstatus(userID) {\n      var _index = this.invitedUserID.indexOf(userID);\n\n      if (_index >= 0) {\n        this.invitedUserID.splice(_index, 1);\n      }\n\n      if (this.invitedUserID.length === 0) {\n        this.changeState('isDialled', false);\n        this.changeState('dialling', false);\n      }\n    },\n    // 通知呼叫方，对方在忙碌，未接通\n    handleInviteeLineBusy: function handleInviteeLineBusy(_ref4) {\n      var sponsor = _ref4.sponsor,\n          userID = _ref4.userID;\n\n      // A call B,C call A, A在忙线， 拒绝通话，对于呼叫者C收到通知，XXX在忙线\n      if (sponsor === this.userID) {\n        this.setCallingstatus(userID);\n        this.$store.commit('showMessage', {\n          message: \"\".concat(userID, \"\\u5FD9\\u7EBF\")\n        });\n      }\n    },\n    // 通知被呼叫方，邀请被取消，未接通\n    handleInviterCancel: function handleInviterCancel() {\n      // 邀请被取消\n      this.changeState('isDialled', false);\n      this.$store.commit('showMessage', {\n        message: '通话已取消'\n      });\n    },\n    handleKickedOut: function handleKickedOut() {// //重复登陆，被踢出房间\n      // this.trtcCalling.logout();\n      // this.$store.commit(\"userLogoutSuccess\");\n    },\n    // 当自己收到对端超时的信令时，或者当我是被邀请者但自己超时了，通知上层通话超时\n    // case: A呼叫B，B在线，B超时未响应，B会触发该事件，A也会触发该事件\n    handleCallTimeout: function handleCallTimeout(_ref5) {\n      var _this6 = this;\n\n      var userIDList = _ref5.userIDList;\n\n      if (this.calling) {\n        return;\n      }\n\n      if (this.userID === this.sponsor) {\n        // 该用户是邀请者\n        userIDList.forEach(function (userID) {\n          _this6.setCallingstatus(userID); //超时未接听\n\n        });\n        return;\n      } //用户是被邀请者\n\n\n      if (userIDList.indexOf(this.userID) > -1) {\n        //当超时者是自己时，添加消息\n        //会话列表切换后发消息\n        this.toAccount && this.sendMessage(this.userID, '', this.callingTips.callTimeout);\n      }\n\n      this.changeState('isDialled', false);\n    },\n    // 双方，通话已建立, 通话结束\n    handleCallEnd: function handleCallEnd(_ref6) {\n      var userID = _ref6.userID,\n          callEnd = _ref6.callEnd;\n\n      // 自己挂断的要补充消息  被邀请者都无应答时结束\n      // 历史消息中没有通话结束\n      if (userID === this.userID && this.invitedUserID.length === 0 || this.callingUserList === 0) {\n        this.sendMessage(userID, callEnd, this.callingTips.callEnd);\n      } //   this.changeState('isDialled', false)\n      //   this.changeState('calling', false)\n\n\n      this.changeState('dialling', false);\n      this.isMicOn = true;\n      this.isCamOn = true;\n      this.maskShow = false;\n      this.isStartLocalView = false; // this.$store.commit('showMessage', {\n      //   message: '通话已结束'\n      // })\n    },\n    // 自己超时且是邀请发起者，需主动挂断，并通知上层对端无应答\n    handleNoResponse: function handleNoResponse(_ref7) {\n      var _this7 = this;\n\n      var sponsor = _ref7.sponsor,\n          userIDList = _ref7.userIDList;\n\n      //邀请者\n      if (sponsor === this.userID) {\n        userIDList.forEach(function (userID) {\n          _this7.setCallingstatus(userID);\n        });\n\n        if (userIDList.indexOf(this.userID) === -1) {\n          //当超时者是自己时，添加消息\n          this.sendMessage(userIDList, '', this.callingTips.callTimeout);\n        }\n      }\n    },\n    handleUserVideoChange: function handleUserVideoChange() {},\n    handleUserAudioChange: function handleUserAudioChange(payload) {\n      var _index = this.invitedUserInfo.findIndex(function (item) {\n        return item.userID === payload.userID;\n      });\n\n      if (_index >= 0) {\n        this.invitedUserInfo[_index].isInvitedMicOn = payload.isAudioAvailable;\n      } // this.isInvitedMicOn = payload.isAudioAvailable\n\n    },\n    // 播放本地流\n    startLocalView: function startLocalView() {\n      var _this8 = this;\n\n      this.trtcCalling.startLocalView({\n        userID: this.userID,\n        videoViewDomID: 'local'\n      }).then(function () {\n        _this8.isStartLocalView = true;\n      });\n    },\n    // 没有用到\n    stopLocalView: function stopLocalView() {\n      this.trtcCalling.stopLocalView({\n        userID: this.userID,\n        videoViewDomID: this.viewLocalDomID\n      });\n    },\n    // 播放远端流\n    startRemoteView: function startRemoteView(userID) {\n      this.trtcCalling.startRemoteView({\n        userID: userID,\n        videoViewDomID: \"video-\".concat(userID)\n      }).then(function () {});\n    },\n    //没有用到\n    stopRemoteView: function stopRemoteView(userID) {\n      this.trtcCalling.stopRemoteView({\n        userID: this.userID,\n        videoViewDomID: \"video-\".concat(userID)\n      });\n    },\n    //获取被呼叫者信息\n    getUserAvatar: function getUserAvatar(userID) {\n      var _this9 = this;\n\n      var _index = this.invitedUserInfo.findIndex(function (item) {\n        return item.userID === userID;\n      });\n\n      if (_index >= 0) {\n        return;\n      }\n\n      var _userIDList = [userID];\n      var promise = this.tim.getUserProfile({\n        userIDList: _userIDList // 请注意：即使只拉取一个用户的资料，也需要用数组类型，例如：userIDList: ['user1']\n\n      });\n      promise.then(function (imResponse) {\n        if (imResponse.data[0]) {\n          _this9.invitedUserInfo.push(imResponse.data[0]);\n        }\n      }).catch(function () {});\n    },\n    changeState: function changeState(state, boolean) {\n      var _this10 = this;\n\n      var stateList = ['dialling', 'isDialled', 'calling'];\n      stateList.forEach(function (item) {\n        _this10[item] = item === state ? boolean : false;\n      });\n      this.$store.commit('UPDATE_ISBUSY', stateList.some(function (item) {\n        return _this10[item];\n      })); // 若stateList 中存在 true , isBusy 为 true\n    },\n    videoCalling: function videoCalling() {\n      var _this11 = this;\n\n      // 发起通话\n      // 初始化被邀请者\n      this.invitedUserID = JSON.parse(JSON.stringify(this.callingInfo.memberList));\n      this.sponsor = this.userID;\n\n      if (this.calling) {\n        // 避免通话按钮多次快速的点击\n        return;\n      }\n\n      this.callType = this.TRTCCalling.CALL_TYPE.VIDEO_CALL;\n      this.isLocalMain = true; // 可设置超时\n\n      if (this.callingInfo.type === this.TIM.TYPES.CONV_C2C) {\n        this.trtcCalling.call({\n          userID: this.callingInfo.memberList[0],\n          type: this.callType,\n          timeout: 30\n        }).then(function (res) {\n          res.data.message.nick = _this11.currentUserProfile.nick;\n\n          _this11.$store.commit('pushCurrentMessageList', res.data.message);\n\n          _this11.changeState('dialling', true);\n        });\n      } else {\n        this.trtcCalling.groupCall({\n          userIDList: this.callingInfo.memberList,\n          type: this.callType,\n          groupID: this.currentConversation.groupProfile.groupID,\n          timeout: 30\n        }).then(function (res) {\n          res.data.message.nick = _this11.currentUserProfile.nick;\n\n          _this11.$store.commit('pushCurrentMessageList', res.data.message);\n\n          _this11.changeState('dialling', true);\n        });\n      }\n    },\n    audioCalling: function audioCalling() {\n      var _this12 = this;\n\n      // 发起通话\n      // 初始化被邀请者\n      this.invitedUserID = this.callingInfo.memberList;\n      this.sponsor = this.userID;\n\n      if (this.calling) {\n        // 避免通话按钮多次快速的点击\n        return;\n      } // // 发起者获取被邀约人信息\n      // this.getUserAvatar()\n      // 可设置超时\n\n\n      this.callType = this.TRTCCalling.CALL_TYPE.AUDIO_CALL;\n\n      if (this.callingInfo.type === 'C2C') {\n        this.trtcCalling.call({\n          userID: this.callingInfo.memberList[0],\n          type: this.callType,\n          timeout: 30\n        }).then(function (res) {\n          _this12.changeState('dialling', true);\n\n          res.data.message.nick = _this12.currentUserProfile.nick;\n\n          _this12.$store.commit('pushCurrentMessageList', res.data.message);\n        });\n      } else {\n        this.trtcCalling.groupCall({\n          userIDList: this.callingInfo.memberList,\n          type: this.callType,\n          groupID: this.currentConversation.groupProfile.groupID,\n          timeout: 30\n        }).then(function (res) {\n          _this12.changeState('dialling', true);\n\n          res.data.message.nick = _this12.currentUserProfile.nick;\n\n          _this12.$store.commit('pushCurrentMessageList', res.data.message);\n        });\n      }\n    },\n    leave: function leave() {\n      var _this13 = this;\n\n      // 离开房间，发起方挂断\n      this.isMicOn = true;\n      this.isCamOn = true;\n      this.maskShow = false;\n      this.isStartLocalView = false;\n\n      if (!this.calling) {\n        // 还没有通话，单方面挂断\n        this.trtcCalling.hangup().then(function (res) {\n          res.data.message.nick = _this13.currentUserProfile.nick;\n\n          _this13.$store.commit('pushCurrentMessageList', res.data.message);\n\n          _this13.changeState('dialling', false);\n\n          clearTimeout(_this13.timer);\n        });\n        return;\n      }\n\n      this.hangUp(); // 通话一段时间之后，某一方面结束通话\n    },\n    refuse: function refuse() {\n      // 拒绝电话\n      this.changeState('isDialled', false);\n      this.reject();\n    },\n    resetDuration: function resetDuration(duration) {\n      var _this14 = this;\n\n      this.duration = duration;\n      this.hangUpTimer = setTimeout(function () {\n        var now = new Date();\n\n        _this14.resetDuration(parseInt((now - _this14.start) / 1000));\n      }, 1000);\n    },\n    isAccept: function isAccept() {\n      // 对方接听自己发起的电话\n      clearTimeout(this.timer);\n      this.changeState('calling', true);\n      clearTimeout(this.hangUpTimer);\n      this.resetDuration(0);\n      this.start = new Date();\n    },\n    hangUp: function hangUp() {\n      // 通话一段时间之后，某一方挂断电话\n      this.changeState('calling', false);\n      this.trtcCalling.hangup();\n      this.$store.commit('showMessage', {\n        message: '已挂断'\n      });\n    },\n    videoHandler: function videoHandler() {\n      // 是否打开摄像头\n      if (this.isCamOn) {\n        this.isCamOn = false;\n        this.maskShow = true;\n        this.trtcCalling.closeCamera();\n      } else {\n        this.isCamOn = true;\n        this.maskShow = false;\n        this.trtcCalling.openCamera();\n      }\n    },\n    micHandler: function micHandler() {\n      // 是否打开麦克风\n      if (this.isMicOn) {\n        this.trtcCalling.setMicMute(true);\n        this.isMicOn = false;\n      } else {\n        this.trtcCalling.setMicMute(false);\n        this.isMicOn = true;\n      }\n    },\n    changeMainVideo: function changeMainVideo() {\n      if (!this.calling) {\n        return;\n      }\n\n      this.isLocalMain = !this.isLocalMain;\n    },\n    sendMessage: function () {\n      var _sendMessage = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(userId, callEnd, callText) {\n        var call_text, messageData, message, customData, _customData;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                call_text = '';\n                userId = Array.isArray(userId) ? userId.join(',') : userId;\n                messageData = {\n                  to: this.toAccount,\n                  from: userId,\n                  conversationType: this.currentConversationType,\n                  payload: {\n                    data: '',\n                    description: '',\n                    extension: ''\n                  }\n                };\n                _context2.next = 5;\n                return this.tim.createCustomMessage(messageData);\n\n              case 5:\n                message = _context2.sent;\n                _context2.t0 = callText;\n                _context2.next = _context2.t0 === this.callingTips.callEnd ? 9 : _context2.t0 === this.callingTips.callTimeout ? 16 : 18;\n                break;\n\n              case 9:\n                if (!(this.currentConversationType === this.TIM.TYPES.CONV_GROUP)) {\n                  _context2.next = 14;\n                  break;\n                }\n\n                call_text = '结束群聊';\n                return _context2.abrupt(\"break\", 20);\n\n              case 14:\n                call_text = callEnd === 0 ? '取消通话' : \"\\u7ED3\\u675F\\u901A\\u8BDD\\uFF0C\\u901A\\u8BDD\\u65F6\\u957F\\uFF1A\".concat(formatDuration(callEnd || this.duration));\n                return _context2.abrupt(\"break\", 20);\n\n              case 16:\n                call_text = '无应答';\n                return _context2.abrupt(\"break\", 20);\n\n              case 18:\n                call_text = '';\n                return _context2.abrupt(\"break\", 20);\n\n              case 20:\n                if (this.currentConversationType === this.TIM.TYPES.CONV_GROUP) {\n                  message.groupID = this.toAccount;\n                  customData = {\n                    operationType: 256,\n                    text: call_text,\n                    userIDList: []\n                  };\n                  message.payload = customData;\n                }\n\n                if (this.currentConversationType === this.TIM.TYPES.CONV_C2C) {\n                  _customData = {\n                    text: call_text\n                  };\n                  message.payload = _customData;\n                }\n\n                if (this.currentConversationType === this.TIM.TYPES.CONV_GROUP) {\n                  message.type = this.TIM.TYPES.MSG_GRP_TIP;\n                }\n\n                message.callType = 'callingTips';\n                this.$store.commit('pushCurrentMessageList', message);\n\n              case 25:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function sendMessage(_x2, _x3, _x4) {\n        return _sendMessage.apply(this, arguments);\n      }\n\n      return sendMessage;\n    }()\n  }\n};",{"version":3,"sources":["calling-index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"call-container\" v-show=\"dialling || calling || isDialled\">\n        <div class=\"choose\" v-show=\"isDialled\">\n            <div class=\"title\">\n                {{ sponsor }}来通话啦\n            </div>\n            <div class=\"buttons\">\n                <div class=\"accept\" @click=\"handleDebounce(accept,500)\"></div>\n                <div class=\"refuse\" @click=\"handleDebounce(refuse,500)\"></div>\n            </div>\n        </div>\n        <div class=\"call\" v-show=\"dialling || calling\">\n            <div class=\"title\" v-if=\"dialling && currentConversationType==='C2C'\">\n                正在呼叫{{toAccount}}...\n            </div>\n            <div class=\"title\" v-if=\"dialling && currentConversationType==='GROUP'\">\n                正在呼叫...\n            </div>\n\n<!--            <div v-show=\"this.callingUserList.length < 2 && callType === TRTCCalling.CALL_TYPE.VIDEO_CALL && calling\">-->\n<!--                <div id=\"local\" @click=\"changeMainVideo\" :class=\"isLocalMain ? 'small' : 'big'\" ></div>-->\n<!--                <div v-for=\"userId in callingUserList\" :id=\"`video-${userId}`\" :key=\"`video-${userId}`\" :class=\"isLocalMain ? 'big' : 'small'\" @click=\"changeMainVideo\"></div>-->\n<!--            </div>-->\n            <div v-show=\" callType === TRTCCalling.CALL_TYPE.VIDEO_CALL && calling\">\n                <div class=\"small-group\"  id=\"small-group\">\n                    <div  class=\"video-box\"  id=\"local\" ></div>\n                    <div  class=\"video-box\" v-for=\"userId in callingUserList\" :id=\"`video-${userId}`\" :key=\"`video-${userId}`\">\n                    </div>\n                </div>\n            </div>\n            <div v-show=\"callType === TRTCCalling.CALL_TYPE.AUDIO_CALL && calling\" class=\"audio-box\">\n                <div v-show=\"calling\" class=\"aduio-call\">\n                    <img :src=\"myAvatar\" class=\"audio-img\">\n                    <p style=\"text-align: center\">\n                        <span class=\"nick-text\">{{myNick}}</span>\n                        <i v-if=\"isMicOn\" class=\"el-icon-microphone micr-icon\" style=\"color: #006FFF;\"></i>\n                        <i  v-else  class=\"el-icon-turn-off-microphone micr-icon\" ></i>\n                    </p>\n                </div>\n                <div v-for=\"item in invitedUserInfo \" class=\"aduio-call\" :key=\"`video-${item.userID}`\" >\n                    <img :src=\"item.avatar || defaultAvatar\" class=\"audio-img\">\n                    <p style=\"text-align: center\">\n                        <span class=\"nick-text\">{{item.nick || item.userID}}</span>\n                        <i v-if=\"item.isInvitedMicOn === true || item.isInvitedMicOn == undefined\" class=\"el-icon-microphone micr-icon\" style=\"color: #006FFF;\"></i>\n                        <i  v-else  class=\"el-icon-turn-off-microphone micr-icon\" ></i>\n                    </p>\n                </div>\n            </div>\n            <div class=\"duration\" v-show=\"calling\">\n                {{ formatDurationStr }}\n            </div>\n            <div class=\"buttons\" v-if=\"callType === TRTCCalling.CALL_TYPE.VIDEO_CALL\">\n                <div :class=\"isCamOn ? 'videoOn' : 'videoOff'\" @click=\"videoHandler\"></div>\n                <div class=\"refuse\" @click=\"handleDebounce(leave,500)\"></div>\n                <div :class=\"isMicOn ? 'micOn' : 'micOff'\" @click=\"micHandler\"></div>\n            </div>\n            <div class=\"buttons\" v-else>\n<!--                <div :class=\"isCamOn ? 'videoOn' : 'videoOff'\" @click=\"videoHandler\"></div>-->\n                <div class=\"refuse\" @click=\"handleDebounce(leave,500)\"></div>\n                <div :class=\"isMicOn ? 'micOn' : 'micOff'\" @click=\"micHandler\"></div>\n            </div>\n<!--            <div class=\"mask\" v-show=\"maskShow\" :class=\"isLocalMain ? 'small' : 'big'\" @click=\"changeMainVideo\">-->\n<!--                <div>-->\n<!--                    <img class=\"image\" src=\"../../../assets/image/camera-max.png\"/>-->\n<!--                    <p class=\"notice\">摄像头未打开</p>-->\n<!--                </div>-->\n<!--            </div>-->\n        </div>\n    </div>\n</template>\n\n<script>\n  import {mapGetters, mapState} from 'vuex'\n  import { formatDuration } from '../../../utils/formatDuration'\n  export default {\n    name: 'CallLayer',\n    data() {\n      return {\n        timeout:null,\n        callType:1,   //1:audio，2:video\n        Trtc: undefined,\n        isCamOn: true,\n        isMicOn: true,\n        isInvitedMicOn:true,\n        maskShow: false,\n        isLocalMain: true, // 本地视频是否是主屏幕显示\n        start: 0,\n        end: 0,\n        duration: 0,\n        hangUpTimer: 0, // 通话计时id\n        ready: false,\n        dialling: false, // 是否拨打电话中\n        calling: false, // 是否通话中\n        isDialled: false, // 是否被呼叫\n        inviteID:'',\n        inviteData:{},\n        sponsor:'',   //发起者\n        invitedUserID:[],  //被邀请者\n        invitedNick:'',\n        invitedUserInfo:[],\n        defaultAvatar:'https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-3.png',\n        viewLocalDomID:'',\n        callingUserList:[],  // 参加通话的人 ,不包括自己\n        callingType:'C2C',  //区分多人和C2C通话的UI样式\n        isStartLocalView:false,  //本地是否开启\n        callingTips:{\n          callEnd:1,   //通话结束\n          callTimeout:5\n        }\n      }\n    },\n    computed: {\n      ...mapGetters(['toAccount', 'currentConversationType']),\n      ...mapState({\n        currentConversation: state => state.conversation.currentConversation,\n        currentUserProfile: state => state.user.currentUserProfile,\n        callingInfo: state => state.conversation.callingInfo,\n        userID: state => state.user.userID,\n        userSig: state => state.user.userSig,\n        videoRoom: state => state.video.videoRoom,\n        sdkAppID: state => state.user.sdkAppID\n      }),\n      formatDurationStr() {\n        return formatDuration(this.duration)\n      },\n\n      myAvatar() {\n          return this.currentUserProfile.avatar || this.defaultAvatar\n      },\n      myNick() {\n\n        return this.currentUserProfile.nick || this.userID\n      }\n    },\n    created() {\n      this.initListener()\n    },\n    watch: {\n      callingUserList: {\n        handler(newValue) {\n          if(newValue.length < 2 && this.calling) {   //单人通话\n            this.$nextTick(() => {\n              let elementId = `video-${newValue[0]}`\n              let element = window.document.getElementById(elementId)\n              let local = window.document.getElementById('local')\n              let group_element = window.document.getElementById('small-group')\n              // element.addEventListener('click', this.changeMainVideo)\n              // local.addEventListener('click', this.changeMainVideo)\n              if (!element || !element.classList) {\n                return\n              }\n              if (!local || !local.classList) {\n                return\n              }\n              element && element.classList.remove('video-box')\n              local && local.classList.remove('video-box')\n              group_element && group_element.classList.add('small-group_box')\n              this.isLocalMain ? element.classList.add('big') : element.classList.add('small')\n              this.isLocalMain ? local.classList.add('small') : element.classList.add('big')\n            })\n            return\n          }\n          if (newValue.length >= 2 && this.calling) {\n            let group_element = window.document.getElementById('small-group')\n            group_element && group_element.classList.remove('small-group_box')\n            let elements = window.document.getElementById('small-group').childNodes\n              elements.forEach((item,index) => {\n                if(index === 0) {\n                  item.classList.remove('small')\n                }\n                item.classList.remove('big')\n                item.classList.add('video-box')\n              })\n          }\n        },\n        deep: true,\n        immediate: true\n      }\n    },\n    destroyed() {\n      this.removeListener()\n      window.addEventListener('beforeunload', () => {\n        this.videoCallLogOut()\n      })\n      window.addEventListener('leave', () => {\n        this.videoCallLogOut()\n      })\n    },\n    mounted() {\n      this.$bus.$on('video-call', this.videoCalling)  // 发起通话\n      this.$bus.$on('audio-call', this.audioCalling)  // 发起通话\n\n    },\n    beforeDestroy() {\n      this.$bus.$off('video-call', this.videoCalling)\n      this.$bus.$off('audio-call', this.audioCalling)  // 发起通话\n\n    },\n    methods: {\n      videoCallLogOut() { // 针对，刷新页面，关闭Tab，登出情况下，通话断开的逻辑\n        if (this.dialling || this.calling) {\n          this.leave()\n        }\n        if (this.isDialled) {\n          this.refuse()\n        }\n      },\n      initListener() {\n        // sdk内部发生了错误\n        this.trtcCalling.on(this.TRTCCalling.EVENT.ERROR, this.handleError)\n        // 被邀请进行通话\n        this.trtcCalling.on(this.TRTCCalling.EVENT.INVITED, this.handleNewInvitationReceived)\n        // 有用户同意进入通话，那么会收到此回调\n        this.trtcCalling.on(this.TRTCCalling.EVENT.USER_ENTER, this.handleUserEnter)\n        // 如果有用户同意离开通话，那么会收到此回调\n        this.trtcCalling.on(this.TRTCCalling.EVENT.USER_LEAVE, this.handleUserLeave)\n        // 用户拒绝通话\n        this.trtcCalling.on(this.TRTCCalling.EVENT.REJECT, this.handleInviteeReject)\n        //邀请方忙线\n        this.trtcCalling.on(this.TRTCCalling.EVENT.LINE_BUSY, this.handleInviteeLineBusy)\n        // 作为被邀请方会收到，收到该回调说明本次通话被取消了\n        this.trtcCalling.on(this.TRTCCalling.EVENT.CALLING_CANCEL, this.handleInviterCancel)\n        // 重复登陆，收到该回调说明被踢出房间\n        this.trtcCalling.on(this.TRTCCalling.EVENT.KICKED_OUT, this.handleKickedOut)\n        // 作为邀请方会收到，收到该回调说明本次通话超时未应答\n        this.trtcCalling.on(this.TRTCCalling.EVENT.CALLING_TIMEOUT, this.handleCallTimeout)\n        // 邀请用户无应答\n        this.trtcCalling.on(this.TRTCCalling.EVENT.NO_RESP, this.handleNoResponse)\n        // 收到该回调说明本次通话结束了\n        this.trtcCalling.on(this.TRTCCalling.EVENT.CALLING_END, this.handleCallEnd)\n        // 远端用户开启/关闭了摄像头, 会收到该回调\n        this.trtcCalling.on(this.TRTCCalling.EVENT.USER_VIDEO_AVAILABLE, this.handleUserVideoChange)\n        // 远端用户开启/关闭了麦克风, 会收到该回调\n        this.trtcCalling.on(this.TRTCCalling.EVENT.USER_AUDIO_AVAILABLE, this.handleUserAudioChange)\n      },\n      removeListener() {\n        this.trtcCalling.off(this.TRTCCalling.EVENT.ERROR, this.handleError)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.INVITED, this.handleNewInvitationReceived)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.USER_ENTER, this.handleUserEnter)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.USER_LEAVE, this.handleUserLeave)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.REJECT, this.handleInviteeReject)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.LINE_BUSY, this.handleInviteeLineBusy)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.CALLING_CANCEL, this.handleInviterCancel)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.KICKED_OUT, this.handleKickedOut)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.CALLING_TIMEOUT, this.handleCallTimeout)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.NO_RESP, this.handleNoResponse)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.CALLING_END, this.handleCallEnd)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.USER_VIDEO_AVAILABLE, this.handleUserVideoChange)\n        this.trtcCalling.off(this.TRTCCalling.EVENT.USER_AUDIO_AVAILABLE, this.handleUserAudioChange)\n      },\n\n      handleError() {},\n      // 被呼叫  接听方\n      async handleNewInvitationReceived (payload) {\n        const { inviteID, sponsor, inviteData, userIDList, isGroupCall } = payload\n        this.inviteID = inviteID\n        this.inviteData = inviteData\n        this.callType = inviteData.callType\n        this.sponsor = sponsor\n        this.invitedUserID = JSON.parse(JSON.stringify(userIDList))//被邀请者\n        this.callingInfo.type = isGroupCall ? this.TIM.TYPES.CONV_GROUP : this.TIM.TYPES.CONV_C2C\n        this.changeState('isDialled', true)\n      },\n\n      accept() {\n        this.trtcCalling.accept({\n          inviteID: this.inviteID,\n          roomID: this.inviteData.roomID,\n          callType: this.inviteData.callType\n        }).then((res) => {\n          // this.callType = this.inviteData.callType\n          this.changeState('calling', true)\n          res.data.message.nick = this.currentUserProfile.nick\n          this.$store.commit('pushCurrentMessageList', res.data.message)\n        })\n      },\n      reject() {\n        const { callType } = this.inviteData\n        this.trtcCalling.reject({\n          inviteID: this.inviteID,\n          isBusy: false,\n          callType\n        }).then((res) =>{\n          res.data.message.nick = this.currentUserProfile.nick\n          this.$store.commit('pushCurrentMessageList', res.data.message)\n        })\n      },\n      handleDebounce (func, wait) {\n        let context = this\n        let args = arguments\n        if (this.timeout) clearTimeout(this.timeout)\n        this.timeout = setTimeout(() => {\n          func.apply(context, args)\n        }, wait)\n      },\n      // 双方建立连接\n      handleUserEnter({ userID }) {\n        this.changeState('dialling', true)\n        this.isAccept()\n        // 判断是否为多人通话\n        if (this.callingUserList.length >= 2) {\n          this.callingType = this.TIM.TYPES.CONV_GROUP\n        }\n        if (this.callingUserList.indexOf(userID) === -1) {\n          if (this.callType === this.TRTCCalling.CALL_TYPE.AUDIO_CALL ) {\n            this.getUserAvatar(userID)\n          } else {\n            this.callingUserList.push(userID)\n          }\n        }\n        if (this.callType === this.TRTCCalling.CALL_TYPE.VIDEO_CALL ) {\n          this.$nextTick(() => {\n            if (!this.isStartLocalView) {\n              this.startLocalView()    //本地只开启一次\n            }\n            this.startRemoteView(userID)   //远端多次拉流\n          })\n        }\n      },\n      // 通话已建立\n      handleUserLeave({ userID }) {\n        if( this.callType === this.TRTCCalling.CALL_TYPE.AUDIO_CALL ) {\n          // 语音通话\n          const _index = this.invitedUserInfo.findIndex(item => item.userID === userID)\n          if (_index >= 0) {\n            this.invitedUserInfo.splice(_index, 1)\n          }\n          return\n        }\n        const index = this.callingUserList.findIndex(item => item === userID)\n        if (index >= 0) {\n          this.callingUserList.splice(index, 1)\n        }\n      },\n      // 通知呼叫方，未接通\n      //userID:invitee(被邀请者）\n      handleInviteeReject({ userID }) {\n          if (this.userID === this.sponsor) {\n              // 发起者\n              this.setCallingstatus(userID)\n              this.$store.commit('showMessage', {\n                  message: `${userID}拒绝通话`\n              })\n          }\n      },\n      setCallingstatus(userID) {\n        const _index = this.invitedUserID.indexOf(userID)\n        if (_index >= 0) {\n          this.invitedUserID.splice(_index, 1)\n        }\n        if ( this.invitedUserID.length ===0 ) {\n          this.changeState('isDialled', false)\n          this.changeState('dialling', false)\n        }\n      },\n      // 通知呼叫方，对方在忙碌，未接通\n      handleInviteeLineBusy({ sponsor, userID }) {\n        // A call B,C call A, A在忙线， 拒绝通话，对于呼叫者C收到通知，XXX在忙线\n        if( sponsor === this.userID ) {\n          this.setCallingstatus(userID)\n          this.$store.commit('showMessage', {\n            message: `${userID}忙线`\n          })\n        }\n      },\n      // 通知被呼叫方，邀请被取消，未接通\n      handleInviterCancel() {\n        // 邀请被取消\n        this.changeState('isDialled', false)\n        this.$store.commit('showMessage', {\n          message: '通话已取消'\n        })\n      },\n\n      handleKickedOut() {\n        // //重复登陆，被踢出房间\n        // this.trtcCalling.logout();\n        // this.$store.commit(\"userLogoutSuccess\");\n      },\n      // 当自己收到对端超时的信令时，或者当我是被邀请者但自己超时了，通知上层通话超时\n      // case: A呼叫B，B在线，B超时未响应，B会触发该事件，A也会触发该事件\n      handleCallTimeout({ userIDList }) {\n        if(this.calling) {\n          return\n        }\n        if (this.userID === this.sponsor) {   // 该用户是邀请者\n          userIDList.forEach((userID) =>{\n            this.setCallingstatus(userID)    //超时未接听\n          })\n          return\n        }\n         //用户是被邀请者\n        if(userIDList.indexOf(this.userID) > -1) {   //当超时者是自己时，添加消息\n          //会话列表切换后发消息\n          this.toAccount && this.sendMessage(this.userID,'',this.callingTips.callTimeout)\n        }\n        this.changeState('isDialled', false)\n      },\n      // 双方，通话已建立, 通话结束\n      handleCallEnd({userID, callEnd}) {\n         // 自己挂断的要补充消息  被邀请者都无应答时结束\n         // 历史消息中没有通话结束\n        if(userID === this.userID && this.invitedUserID.length === 0 || this.callingUserList === 0) {\n          this.sendMessage(userID,callEnd,this.callingTips.callEnd)\n        }\n        //   this.changeState('isDialled', false)\n        //   this.changeState('calling', false)\n          this.changeState('dialling', false)\n          this.isMicOn = true\n          this.isCamOn = true\n          this.maskShow = false\n          this.isStartLocalView = false\n          // this.$store.commit('showMessage', {\n          //   message: '通话已结束'\n          // })\n\n      },\n      // 自己超时且是邀请发起者，需主动挂断，并通知上层对端无应答\n      handleNoResponse({ sponsor, userIDList }) {  //邀请者\n        if(sponsor === this.userID) {\n          userIDList.forEach((userID) =>{\n            this.setCallingstatus(userID)\n          })\n          if(userIDList.indexOf(this.userID) === -1) {   //当超时者是自己时，添加消息\n            this.sendMessage(userIDList,'',this.callingTips.callTimeout)\n          }\n        }\n\n      },\n      handleUserVideoChange() {\n\n      },\n\n      handleUserAudioChange(payload) {\n        const _index = this.invitedUserInfo.findIndex(item => item.userID === payload.userID)\n        if (_index >= 0) {\n          this.invitedUserInfo[_index].isInvitedMicOn = payload.isAudioAvailable\n        }\n        // this.isInvitedMicOn = payload.isAudioAvailable\n      },\n\n      // 播放本地流\n      startLocalView() {\n        this.trtcCalling.startLocalView({\n          userID: this.userID,\n          videoViewDomID: 'local'\n        }).then(()=>{\n          this.isStartLocalView = true\n        })\n      },\n\n      // 没有用到\n      stopLocalView() {\n        this.trtcCalling.stopLocalView({\n          userID: this.userID,\n          videoViewDomID: this.viewLocalDomID\n        })\n      },\n      // 播放远端流\n      startRemoteView(userID) {\n        this.trtcCalling.startRemoteView({\n          userID: userID,\n          videoViewDomID: `video-${userID}`\n        }).then(()=>{\n\n        })\n      },\n      //没有用到\n      stopRemoteView(userID) {\n        this.trtcCalling.stopRemoteView({\n          userID: this.userID,\n          videoViewDomID: `video-${userID}`\n        })\n      },\n      //获取被呼叫者信息\n      getUserAvatar(userID) {\n        const _index = this.invitedUserInfo.findIndex(item => item.userID === userID)\n        if (_index >= 0) {\n          return\n        }\n        let _userIDList = [userID]\n        let promise = this.tim.getUserProfile({\n          userIDList:_userIDList  // 请注意：即使只拉取一个用户的资料，也需要用数组类型，例如：userIDList: ['user1']\n        })\n        promise.then((imResponse)=> {\n          if (imResponse.data[0]) {\n            this.invitedUserInfo.push(imResponse.data[0])\n          }\n        }).catch(()=> {\n        })\n      },\n      changeState(state, boolean) {\n        let stateList = ['dialling', 'isDialled', 'calling']\n        stateList.forEach(item => {\n          this[item] = item === state ? boolean : false\n        })\n        this.$store.commit('UPDATE_ISBUSY', stateList.some(item => this[item])) // 若stateList 中存在 true , isBusy 为 true\n      },\n      videoCalling() { // 发起通话\n        // 初始化被邀请者\n        this.invitedUserID =JSON.parse(JSON.stringify(this.callingInfo.memberList))\n        this.sponsor = this.userID\n        if (this.calling) { // 避免通话按钮多次快速的点击\n          return\n        }\n        this.callType = this.TRTCCalling.CALL_TYPE.VIDEO_CALL\n        this.isLocalMain = true\n        // 可设置超时\n        if(this.callingInfo.type === this.TIM.TYPES.CONV_C2C) {\n          this.trtcCalling.call({\n            userID: this.callingInfo.memberList[0],\n            type: this.callType,\n            timeout: 30\n          }).then((res)=>{\n            res.data.message.nick = this.currentUserProfile.nick\n            this.$store.commit('pushCurrentMessageList', res.data.message)\n            this.changeState('dialling', true)\n          })\n        } else {\n            this.trtcCalling.groupCall({\n            userIDList: this.callingInfo.memberList,\n            type: this.callType,\n            groupID: this.currentConversation.groupProfile.groupID,\n            timeout: 30\n          }).then((res)=>{\n            res.data.message.nick = this.currentUserProfile.nick\n            this.$store.commit('pushCurrentMessageList', res.data.message)\n            this.changeState('dialling', true)\n          })\n        }\n\n\n      },\n      audioCalling() { // 发起通话\n        // 初始化被邀请者\n        this.invitedUserID = this.callingInfo.memberList\n          this.sponsor = this.userID\n        if (this.calling) { // 避免通话按钮多次快速的点击\n          return\n        }\n        // // 发起者获取被邀约人信息\n        // this.getUserAvatar()\n        // 可设置超时\n        this.callType = this.TRTCCalling.CALL_TYPE.AUDIO_CALL\n        if(this.callingInfo.type === 'C2C') {\n          this.trtcCalling.call({\n            userID: this.callingInfo.memberList[0],\n            type: this.callType,\n            timeout: 30\n          }).then((res)=>{\n            this.changeState('dialling', true)\n            res.data.message.nick = this.currentUserProfile.nick\n            this.$store.commit('pushCurrentMessageList', res.data.message)\n\n          })\n        } else {\n          this.trtcCalling.groupCall({\n            userIDList: this.callingInfo.memberList,\n            type: this.callType,\n            groupID: this.currentConversation.groupProfile.groupID,\n            timeout: 30\n          }).then((res)=>{\n            this.changeState('dialling', true)\n            res.data.message.nick = this.currentUserProfile.nick\n            this.$store.commit('pushCurrentMessageList', res.data.message)\n          })\n        }\n      },\n      leave() { // 离开房间，发起方挂断\n        this.isMicOn = true\n        this.isCamOn = true\n        this.maskShow = false\n        this.isStartLocalView = false\n        if (!this.calling) { // 还没有通话，单方面挂断\n          this.trtcCalling.hangup().then((res) => {\n            res.data.message.nick = this.currentUserProfile.nick\n            this.$store.commit('pushCurrentMessageList', res.data.message)\n            this.changeState('dialling', false)\n            clearTimeout(this.timer)\n\n          })\n          return\n        }\n        this.hangUp() // 通话一段时间之后，某一方面结束通话\n      },\n\n      refuse() { // 拒绝电话\n        this.changeState('isDialled', false)\n        this.reject()\n      },\n      resetDuration(duration) {\n        this.duration = duration\n        this.hangUpTimer = setTimeout(() => {\n          let now = new Date()\n          this.resetDuration(parseInt((now - this.start) / 1000))\n        }, 1000)\n      },\n\n      isAccept() { // 对方接听自己发起的电话\n        clearTimeout(this.timer)\n        this.changeState('calling', true)\n        clearTimeout(this.hangUpTimer)\n        this.resetDuration(0)\n        this.start = new Date()\n      },\n      hangUp() { // 通话一段时间之后，某一方挂断电话\n        this.changeState('calling', false)\n        this.trtcCalling.hangup()\n        this.$store.commit('showMessage', {\n          message: '已挂断'\n        })\n      },\n      videoHandler() { // 是否打开摄像头\n        if (this.isCamOn) {\n          this.isCamOn = false\n          this.maskShow = true\n          this.trtcCalling.closeCamera()\n        } else {\n          this.isCamOn = true\n          this.maskShow = false\n          this.trtcCalling.openCamera()\n        }\n      },\n      micHandler() { // 是否打开麦克风\n        if (this.isMicOn) {\n          this.trtcCalling.setMicMute(true)\n          this.isMicOn = false\n        } else {\n          this.trtcCalling.setMicMute(false)\n          this.isMicOn = true\n        }\n      },\n      changeMainVideo() {\n        if (!this.calling) {\n          return\n        }\n        this.isLocalMain = !this.isLocalMain\n      },\n     async sendMessage(userId,callEnd,callText) {\n        let call_text= ''\n       userId = Array.isArray(userId) ? userId.join(',') : userId\n        let messageData = {\n          to: this.toAccount,\n          from:userId,\n          conversationType: this.currentConversationType,\n          payload: {\n            data: '',\n            description: '',\n            extension: ''\n          }\n        }\n\n        const message = await this.tim.createCustomMessage(messageData)\n        switch (callText) {\n          case this.callingTips.callEnd:\n            if (this.currentConversationType === this.TIM.TYPES.CONV_GROUP) {\n              call_text = '结束群聊'\n              break\n            } else {\n              call_text = callEnd === 0 ?'取消通话' : `结束通话，通话时长：${formatDuration(callEnd || this.duration)}`\n              break\n            }\n          case this.callingTips.callTimeout:\n            call_text = '无应答'\n            break\n          default:\n            call_text = ''\n            break\n        }\n        if (this.currentConversationType === this.TIM.TYPES.CONV_GROUP) {\n          message.groupID = this.toAccount\n          let customData = {\n            operationType:256,\n            text:call_text,\n            userIDList:[]\n          }\n          message.payload = customData\n\n        }\n        if (this.currentConversationType === this.TIM.TYPES.CONV_C2C) {\n          let customData = {\n            text:call_text\n          }\n          message.payload = customData\n\n        }\n        if (this.currentConversationType === this.TIM.TYPES.CONV_GROUP) {\n          message.type = this.TIM.TYPES.MSG_GRP_TIP\n        }\n        message.callType = 'callingTips'\n        this.$store.commit('pushCurrentMessageList', message)\n      },\n    }\n  }\n</script>\n\n<style lang=\"stylus\" scoped>\n    .call-container\n        background center url(\"data:image/png;base64,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\")\n        background-size cover\n        position absolute\n        z-index 999\n\n    .accept, .refuse, .videoOn, .videoOff, .micOn, .micOff\n        height 50px\n        width 50px\n        box-sizing border-box\n        border-radius 50%\n        cursor: pointer\n\n    .accept\n        background center no-repeat url(\"../../../assets/image/call.png\")\n        background-size 60%\n        background-color $success\n\n    .refuse\n        background center no-repeat url(\"../../../assets/image/close.png\")\n        background-size 70%\n        background-color $danger\n\n    .videoOn\n        background center no-repeat url(\"../../../assets/image/big-camera-on.png\")\n\n    .videoOff\n        background center no-repeat url(\"../../../assets/image/big-camera-off.png\")\n\n    .micOn\n        background center no-repeat url(\"../../../assets/image/big-mic-on.png\")\n\n    .micOff\n        background center no-repeat url(\"../../../assets/image/big-mic-off.png\")\n\n    .buttons\n        position absolute\n        z-index 20\n        width 70%\n        top 75%\n        display flex\n        justify-content space-around\n        margin 0 15% 0 15%\n    .audio-box\n        position absolute\n        z-index 20\n        width 70%\n        top 200px\n        display flex\n        justify-content center\n        margin 0 15% 0 15%\n    .aduio-call\n        box-sizing border-box\n        width 140px\n        height 100px\n    .audio-img\n        display block\n        width 60px\n        height 60px\n        border-radius 50%\n        margin 0 auto 13px\n    .micr-icon\n        cursor pointer\n        font-size 28px\n        /*display block*/\n        /*text-align center*/\n    .nick-text\n        color #dddddd\n        font-size 12px\n        margin-right 5px\n        vertical-align super\n\n    .duration\n        color #fff\n        position absolute\n        z-index 20\n        width 100%\n        top 70%\n        display flex\n        justify-content center\n\n    .mask\n        position absolute\n        z-index 10\n        background #D8D8D8\n        height 100%\n        width 100%\n        display flex\n        align-items center\n        justify-content center\n\n        space\n        .image\n            margin-left 15%\n\n        .notice\n            color #888888\n\n    .choose, .call\n        color #fff\n        background-color rgba(0, 0, 0, 0.8)\n        height 100%\n        width 100%\n\n    .title\n        margin 25% 0 0 0\n        text-align center\n        width 100%\n        position absolute\n        z-index 10\n        color #fff\n        font-size 40px\n        font-weight 700\n\n    .big\n        position absolute\n        height 100%\n        width 100%\n\n    .small\n        position absolute\n        margin-left 74.8%\n        z-index 999\n        border-style solid\n        border-width 1px\n        border-color #808080\n        height 44.8%\n        width 25.2%\n    .big-group\n        height 60vh\n        width 100%\n\n    .small-group\n        display flex\n        flex-wrap wrap\n        position absolute\n        /*z-index 999*/\n        /*border-style solid*/\n        /*border-width 1px*/\n        /*border-color #808080*/\n        /*height 30%*/\n        width 100%\n        /*height 100%*/\n    .small-group_box {\n        height 100%\n    }\n    .video-box\n       width 33.3%\n       height 25vh\n\n\n</style>\n"],"sourceRoot":"src/components/message/trtc-calling"}]}