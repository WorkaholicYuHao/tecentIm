{"remainingRequest":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js!/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuhao/TIMSDK/H5/src/components/group-live/components/live-chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuhao/TIMSDK/H5/src/components/group-live/components/live-chat.vue","mtime":1616982605599},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _Tooltip2 from \"element-ui/lib/theme-chalk/tooltip.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Tooltip from \"element-ui/lib/tooltip\";\nimport _defineProperty from \"/Users/yuhao/TIMSDK/H5/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState } from 'vuex';\nimport liveGift from \"./live-gift\";\nexport default {\n  name: 'liveChat',\n  data: function data() {\n    return {\n      sendAvailable: false,\n      messageContent: '',\n      defaultAvatar: 'https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png',\n      giftInfo: [{\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482989_25.png',\n        name: '火箭'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1507876726_3',\n        name: '鸡蛋'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482294_7.png',\n        name: '吻'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482461_11.png',\n        name: '跑车'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1594714453_7.png',\n        name: '嘉年华'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482754_17.png',\n        name: '玫瑰'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1594281297_11.png',\n        name: '直升机'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1507876472_1',\n        name: '点赞'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483038_27.png',\n        name: '比心'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483168_31.png',\n        name: '冰淇淋'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483225_33.png',\n        name: '玩偶'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483278_35.png',\n        name: '蛋糕'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483348_37.png',\n        name: '豪华轿车'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483429_39.png',\n        name: '游艇'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483505_41.png',\n        name: '翅膀'\n      }]\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapState({\n    user: function user(state) {\n      return state.user;\n    },\n    groupLiveInfo: function groupLiveInfo(state) {\n      return state.groupLive.groupLiveInfo;\n    },\n    avChatRoomMessageList: function avChatRoomMessageList(state) {\n      var list = state.groupLive.avChatRoomMessageList;\n      list.map(function (item) {\n        if (item.type === 'TIMCustomElem' && typeof item.payload.data === 'string' && item.payload.data.indexOf('{') > -1) {\n          item.payload.data = JSON.parse(item.payload.data);\n        }\n\n        return item;\n      });\n      return list;\n    } // avChatRoomBarrageMessageList: state => state.groupLive.avChatRoomBarrageMessageList,\n    // avChatRoomGiftMessageList: state => state.groupLive.avChatRoomGiftMessageList,\n\n  })), {}, {\n    isAnchor: function isAnchor() {\n      return this.user.userID === this.groupLiveInfo.anchorID;\n    }\n  }),\n  components: {\n    liveGift: liveGift,\n    ElTooltip: _Tooltip\n  },\n  created: function created() {\n    var _this = this;\n\n    // 此处监听，防止观众侧派发加群事件时，该组件中还未注册监听\n    this.$bus.$on('join-group-live-avchatroom', function () {\n      _this.joinGroupLiveAvChatRoom();\n    });\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n\n    this.$bus.$on('group-live-send-gift', function (index) {\n      var message = _this2.tim.createCustomMessage({\n        to: _this2.groupLiveInfo.roomID,\n        conversationType: _this2.TIM.TYPES.CONV_GROUP,\n        payload: {\n          data: JSON.stringify({\n            version: '1.0.0',\n            'message': \"\".concat(index),\n            'command': '6',\n            'action': 301\n          }),\n          description: '',\n          extension: ''\n        }\n      }); // 此处用JSON序列化和反序列化对message断链\n\n\n      _this2.$store.commit('pushAvChatRoomMessageList', JSON.parse(JSON.stringify(message)));\n\n      _this2.tim.sendMessage(message).catch(function (error) {\n        _this2.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        });\n      });\n    });\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.$bus.$off('join-group-live-avchatroom');\n    this.$bus.$off('group-live-send-gift');\n\n    if (!this.isAnchor && this.groupLiveInfo.isNeededQuitRoom === 1) {\n      this.quitGroupLiveAvChatRoom();\n    }\n\n    this.$store.commit('updateGroupLiveInfo', {\n      isNeededQuitRoom: 0\n    });\n  },\n  methods: {\n    getAvatar: function getAvatar(item) {\n      if (item.from === this.user.userID) {\n        return this.user.currentUserProfile.avatar || this.defaultAvatar;\n      }\n\n      return item.avatar || this.defaultAvatar;\n    },\n    getNick: function getNick(item) {\n      if (item.from === this.user.userID) {\n        return this.user.currentUserProfile.nick || item.from;\n      }\n\n      return item.nick || item.from;\n    },\n    // 进入直播互动群\n    joinGroupLiveAvChatRoom: function joinGroupLiveAvChatRoom() {\n      var _this3 = this;\n\n      this.tim.joinGroup({\n        groupID: this.groupLiveInfo.roomID\n      }).then(function (imResponse) {\n        var status = imResponse.data.status;\n\n        if (status === _this3.TIM.TYPES.JOIN_STATUS_SUCCESS || status === _this3.TIM.TYPES.JOIN_STATUS_ALREADY_IN_GROUP) {\n          _this3.sendAvailable = true;\n        }\n      }).catch(function () {});\n    },\n    // 退出直播互动群\n    quitGroupLiveAvChatRoom: function quitGroupLiveAvChatRoom() {\n      this.tim.quitGroup(this.groupLiveInfo.roomID).then(function () {}).catch(function () {});\n    },\n    sendMessage: function sendMessage() {\n      var _this4 = this;\n\n      if (!this.sendAvailable) {\n        this.$store.commit('showMessage', {\n          message: '开始直播后可以互动聊天哦！',\n          type: 'warning'\n        });\n        return;\n      }\n\n      if (this.messageContent === '' || this.messageContent.trim().length === 0) {\n        this.messageContent = '';\n        this.$store.commit('showMessage', {\n          message: '不能发送空消息哦！',\n          type: 'info'\n        });\n        return;\n      }\n\n      var message = this.tim.createTextMessage({\n        to: this.groupLiveInfo.roomID,\n        conversationType: this.TIM.TYPES.CONV_GROUP,\n        payload: {\n          text: this.messageContent\n        }\n      }); // 此处用JSON序列化和反序列化对message断链\n\n      this.$store.commit('pushAvChatRoomMessageList', JSON.parse(JSON.stringify(message)));\n      this.tim.sendMessage(message).catch(function (error) {\n        _this4.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        });\n      });\n      this.messageContent = '';\n    }\n  },\n  watch: {\n    avChatRoomMessageList: function avChatRoomMessageList() {\n      var _this5 = this;\n\n      this.$nextTick(function () {\n        var messageListNode = _this5.$refs['message-list'];\n\n        if (!messageListNode) {\n          return;\n        }\n\n        messageListNode.scrollTop = messageListNode.scrollHeight;\n      });\n    }\n  }\n};",{"version":3,"sources":["live-chat.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"comment-wrapper\">\n      <div class=\"message-list\" ref=\"message-list\">\n        <template v-for=\"(item, index) in avChatRoomMessageList\">\n          <!-- 进群提示消息 -->\n          <template v-if=\"item.type === 'TIMGroupTipElem' && item.payload.groupJoinType === 1\">\n            <div class=\"msg-item-join\" :key=\"`join_msg_item_${index}`\">{{`欢迎${item.nick || item.payload.userIDList.join('')}进入直播间`}}</div>\n          </template>\n          <!-- 退群提示消息 -->\n          <template v-if=\"item.type === 'TIMGroupTipElem' && item.payload.groupJoinType === 0\">\n            <div class=\"msg-item-join\" :key=\"`leave_msg_item_${index}`\">{{`${item.nick || item.payload.userIDList.join('')}离开了直播间`}}</div>\n          </template>\n          <!-- 普通文本消息 -->\n          <template v-if=\"item.type === 'TIMTextElem'\">\n            <div class=\"msg-item-text\" :key=\"`text_msg_item_${index}`\">\n              <img class=\"avatar\" :src=\"getAvatar(item)\" alt=\"\"/>\n              <p class=\"nick\" >{{getNick(item)}}</p>\n              <p class=\"msg\" ><span class=\"msg-text\">{{ item.payload.text }}</span></p>\n            </div>\n          </template>\n          <template v-if=\"item.type === 'TIMCustomElem'\">\n            <!-- native 弹幕消息 -->\n            <template v-if=\"item.payload.data.command === '5'\">\n              <div class=\"msg-item-text\" :key=\"`barrage_msg_item_${index}`\">\n              <img class=\"avatar\" :src=\"getAvatar(item)\" alt=\"\"/>\n              <p class=\"nick\" >{{getNick(item)}}</p>\n              <p class=\"msg\" ><span class=\"msg-text\">{{ item.payload.data.message }}</span></p>\n            </div>\n            </template>\n            <!-- 礼物消息 -->\n            <template v-if=\"item.payload.data.command === '6'\">\n              <div class=\"msg-item-gift\" :key=\"`gift_msg_item_${index}`\">\n                <img class=\"avatar\" :src=\"getAvatar(item)\" alt=\"\"/>\n                <p class=\"nick\" >{{getNick(item)}}</p>\n                <p class=\"msg\" >送了一个{{ giftInfo[item.payload.data.message - 1].name }}</p>\n                <img class=\"gift-pic\" :src=\"giftInfo[item.payload.data.message - 1].icon\" alt=\"\" />\n              </div>\n            </template>\n          </template>\n        </template>\n      </div>\n      <live-gift  v-if=\"!isAnchor\" />\n      <div class=\"send-container\">\n        <textarea\n          class=\"comment-message\"\n          :placeholder=\"`${sendAvailable ? '请输入内容...' : '开始直播后可以互动聊天哦！'}`\"\n          v-model=\"messageContent\"\n          :disabled=\"!sendAvailable\"\n          @keyup.enter=\"sendMessage\"\n        ></textarea>\n        <el-tooltip\n          class=\"item\"\n          effect=\"dark\"\n          content=\"按Enter发送消息\"\n          placement=\"left-start\"\n        >\n           <div class=\"btn-send\" @click=\"sendMessage\">\n            <div class=\"tim-icon-send\"></div>\n          </div>\n        </el-tooltip>\n      </div>\n    </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\nimport { Tooltip } from 'element-ui'\nimport liveGift from './live-gift'\n\nexport default {\n  name: 'liveChat',\n  data() {\n    return {\n      sendAvailable: false,\n      messageContent: '',\n      defaultAvatar: 'https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png',\n      giftInfo: [\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482989_25.png',\n          name: '火箭'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1507876726_3',\n          name: '鸡蛋'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482294_7.png',\n          name: '吻'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482461_11.png',\n          name: '跑车'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1594714453_7.png',\n          name: '嘉年华'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482754_17.png',\n          name: '玫瑰'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1594281297_11.png',\n          name: '直升机'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1507876472_1',\n          name: '点赞'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483038_27.png',\n          name: '比心'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483168_31.png',\n          name: '冰淇淋'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483225_33.png',\n          name: '玩偶'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483278_35.png',\n          name: '蛋糕'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483348_37.png',\n          name: '豪华轿车'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483429_39.png',\n          name: '游艇'\n        },\n        {\n          icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483505_41.png',\n          name: '翅膀'\n        }\n      ]\n    }\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user,\n      groupLiveInfo: state => state.groupLive.groupLiveInfo,\n      avChatRoomMessageList: state => {\n        const list = state.groupLive.avChatRoomMessageList\n        list.map((item) => {\n          if (item.type === 'TIMCustomElem' && typeof item.payload.data === 'string' && item.payload.data.indexOf('{') > -1) {\n            item.payload.data = JSON.parse(item.payload.data)\n          }\n          return item\n        })\n        return list\n      },\n      // avChatRoomBarrageMessageList: state => state.groupLive.avChatRoomBarrageMessageList,\n      // avChatRoomGiftMessageList: state => state.groupLive.avChatRoomGiftMessageList,\n    }),\n    isAnchor () {\n      return this.user.userID === this.groupLiveInfo.anchorID\n    }\n  },\n  components: {\n    liveGift,\n    ElTooltip: Tooltip,\n  },\n  created() {\n    // 此处监听，防止观众侧派发加群事件时，该组件中还未注册监听\n    this.$bus.$on('join-group-live-avchatroom', () => {\n      this.joinGroupLiveAvChatRoom()\n    })\n  },\n  mounted() {\n    this.$bus.$on('group-live-send-gift', (index)=> {\n      const message = this.tim.createCustomMessage({\n        to: this.groupLiveInfo.roomID,\n        conversationType: this.TIM.TYPES.CONV_GROUP,\n        payload: {\n          data: JSON.stringify({version: '1.0.0' ,'message': `${index}`,'command':'6','action':301}),\n          description: '',\n          extension: ''\n        }\n      })\n      // 此处用JSON序列化和反序列化对message断链\n      this.$store.commit('pushAvChatRoomMessageList', JSON.parse(JSON.stringify(message)))\n      this.tim.sendMessage(message).catch(error => {\n        this.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        })\n      })\n    })\n  },\n  beforeDestroy() {\n    this.$bus.$off('join-group-live-avchatroom')\n    this.$bus.$off('group-live-send-gift')\n    if (!this.isAnchor && this.groupLiveInfo.isNeededQuitRoom === 1) {\n      this.quitGroupLiveAvChatRoom()\n    }\n    this.$store.commit('updateGroupLiveInfo', { isNeededQuitRoom: 0 })\n  },\n  methods: {\n    getAvatar (item) {\n      if (item.from === this.user.userID) {\n        return this.user.currentUserProfile.avatar || this.defaultAvatar\n      }\n      return item.avatar || this.defaultAvatar\n    },\n    getNick (item) {\n      if (item.from === this.user.userID) {\n        return this.user.currentUserProfile.nick || item.from\n      }\n      return item.nick || item.from\n    },\n    // 进入直播互动群\n    joinGroupLiveAvChatRoom() {\n      this.tim.joinGroup({\n        groupID: this.groupLiveInfo.roomID\n      }).then((imResponse) => {\n        const status = imResponse.data.status\n        if (status === this.TIM.TYPES.JOIN_STATUS_SUCCESS || status === this.TIM.TYPES.JOIN_STATUS_ALREADY_IN_GROUP) {\n          this.sendAvailable = true\n        }\n      }).catch(() => {})\n    },\n    // 退出直播互动群\n    quitGroupLiveAvChatRoom() {\n      this.tim.quitGroup(this.groupLiveInfo.roomID).then(() => {}).catch(() => {})\n    },\n    sendMessage() {\n      if (!this.sendAvailable) {\n        this.$store.commit('showMessage', {\n          message: '开始直播后可以互动聊天哦！',\n          type: 'warning'\n        })\n        return\n      }\n      if (this.messageContent === '' || this.messageContent.trim().length === 0) {\n        this.messageContent = ''\n        this.$store.commit('showMessage', {\n          message: '不能发送空消息哦！',\n          type: 'info'\n        })\n        return\n      }\n      const message = this.tim.createTextMessage({\n        to: this.groupLiveInfo.roomID,\n        conversationType: this.TIM.TYPES.CONV_GROUP,\n        payload: { text: this.messageContent }\n      })\n      // 此处用JSON序列化和反序列化对message断链\n      this.$store.commit('pushAvChatRoomMessageList', JSON.parse(JSON.stringify(message)))\n      this.tim.sendMessage(message).catch(error => {\n        this.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        })\n      })\n      this.messageContent = ''\n    }\n  },\n  watch: {\n    avChatRoomMessageList: function() {\n      this.$nextTick(() => {\n        let messageListNode = this.$refs['message-list']\n        if (!messageListNode) {\n          return\n        }\n        messageListNode.scrollTop = messageListNode.scrollHeight\n      })\n    }\n  }\n}\n</script>\n<style lang=\"stylus\" scoped>\n  ::-webkit-textarea-placeholder {\n    color: #a5b5c1\n  }\n  ::-moz-textarea-placeholder {\n    color: #a5b5c1\n  }\n  ::-ms-textarea-placeholder {\n    color: #a5b5c1\n  }\n  .comment-wrapper {\n    position relative\n    box-sizing border-box\n    width 100%\n    height 100%\n    display flex\n    flex-flow column\n  }\n  .message-list {\n      position: relative;\n      width: 100%;\n      overflow: auto;\n      overflow-x: hidden;\n      -webkit-box-sizing: border-box;\n      box-sizing: border-box;\n      overflow-y: scroll;\n      -webkit-overflow-scrolling: touch;\n      padding: 20px;\n      margin-bottom: 5px;\n      flex 1\n      .msg-item-join {\n        margin: 0 30px 20px 30px\n        padding: 4px 15px\n        border-radius: 3px\n        color: #a5b5c1\n        font-size: 12px\n        text-align: center\n        box-sizing: border-box\n        white-space: nowrap\n        overflow: hidden\n        text-overflow: ellipsis\n\n      }\n      .msg-item-text {\n        width 100%\n        min-height 60px\n        .avatar {\n          width 45px\n          height 45px\n          border-radius 50%\n        }\n        .nick {\n          position relative\n          top -24px\n          left 8px\n          color #a5b5c1\n          font-size 14px\n          margin 0\n          max-width 150px !important\n          display inline-block\n          overflow hidden\n          text-overflow ellipsis\n          white-space nowrap\n        }\n        .msg {\n          position relative\n          top -25px\n          left 60px\n          word-break break-all\n          color #fff\n          margin 0\n          max-width 230px\n          .msg-text {\n            display inline-block\n            height 100%\n            background-color #5cadff\n            border-radius 0 4px 4px 4px\n            padding 10px\n            font-size 14px\n          }\n        }\n        .msg::before {\n          position: absolute\n          top: 0\n          width: 12px\n          height: 40px\n          content: \"\\E900\"\n          font-family: 'tim' !important\n          font-size: 24px\n          transform scaleX(-1)\n          left -10px\n          color #5cadff\n        }\n      }\n      .msg-item-gift {\n        position relative\n        width 60%\n        min-width 290px\n        height 60px\n        background #5cadff\n        border-radius 30px\n        margin 0 0 20px 0\n        .avatar {\n          width 45px\n          height 45px\n          border-radius 50%\n          margin 8px\n        }\n        .nick {\n          position relative\n          top -32px\n          left 0px\n          color #fff\n          margin 0\n          font-size 14px\n          max-width 150px !important\n          display inline-block\n          overflow hidden\n          text-overflow ellipsis\n          white-space nowrap\n        }\n        .msg {\n          position relative\n          top -35px\n          left -5px\n          padding 0 0 0 65px\n          word-break break-all\n          color #fff\n          margin 0\n          font-size 14px\n        }\n        .gift-pic {\n          position absolute\n          top -15px\n          right -18px\n          width 75px\n          height 75px\n        }\n      }\n    }\n    .send-container {\n      position relative\n      width 100%\n      height 100px\n      -webkit-box-sizing border-box\n      box-sizing border-box\n      border-top 1px solid #e6e6e6\n      display flex\n      flex-flow column\n      .comment-message {\n        flex 1\n        margin 0\n        border-radius 0\n        border hidden\n        outline-style none\n        padding 10px\n        font-size 16px\n        color #000\n        resize none\n      }\n      .btn-send {\n        position: absolute\n        color: #2d8cf0\n        font-size: 30px\n        right: 0px\n        bottom: 0px\n        padding: 6px 6px 4px 4px\n        cursor: pointer\n      }\n    }\n</style>\n"],"sourceRoot":"src/components/group-live/components"}]}