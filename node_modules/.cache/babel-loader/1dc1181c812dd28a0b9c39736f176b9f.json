{"remainingRequest":"/Users/yuhao/TIMSDK/H5/node_modules/thread-loader/dist/cjs.js!/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js!/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuhao/TIMSDK/H5/src/components/group-live/components/live-chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuhao/TIMSDK/H5/src/components/group-live/components/live-chat.vue","mtime":1616982605599},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _Tooltip2 from \"element-ui/lib/theme-chalk/tooltip.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Tooltip from \"element-ui/lib/tooltip\";\nimport _defineProperty from \"/Users/yuhao/TIMSDK/H5/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState } from 'vuex';\nimport liveGift from \"./live-gift\";\nexport default {\n  name: 'liveChat',\n  data: function data() {\n    return {\n      sendAvailable: false,\n      messageContent: '',\n      defaultAvatar: 'https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png',\n      giftInfo: [{\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482989_25.png',\n        name: '火箭'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1507876726_3',\n        name: '鸡蛋'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482294_7.png',\n        name: '吻'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482461_11.png',\n        name: '跑车'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1594714453_7.png',\n        name: '嘉年华'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590482754_17.png',\n        name: '玫瑰'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1594281297_11.png',\n        name: '直升机'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1507876472_1',\n        name: '点赞'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483038_27.png',\n        name: '比心'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483168_31.png',\n        name: '冰淇淋'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483225_33.png',\n        name: '玩偶'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483278_35.png',\n        name: '蛋糕'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483348_37.png',\n        name: '豪华轿车'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483429_39.png',\n        name: '游艇'\n      }, {\n        icon: 'https://8.url.cn/huayang/resource/now/new_gift/1590483505_41.png',\n        name: '翅膀'\n      }]\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapState({\n    user: function user(state) {\n      return state.user;\n    },\n    groupLiveInfo: function groupLiveInfo(state) {\n      return state.groupLive.groupLiveInfo;\n    },\n    avChatRoomMessageList: function avChatRoomMessageList(state) {\n      var list = state.groupLive.avChatRoomMessageList;\n      list.map(function (item) {\n        if (item.type === 'TIMCustomElem' && typeof item.payload.data === 'string' && item.payload.data.indexOf('{') > -1) {\n          item.payload.data = JSON.parse(item.payload.data);\n        }\n\n        return item;\n      });\n      return list;\n    } // avChatRoomBarrageMessageList: state => state.groupLive.avChatRoomBarrageMessageList,\n    // avChatRoomGiftMessageList: state => state.groupLive.avChatRoomGiftMessageList,\n\n  })), {}, {\n    isAnchor: function isAnchor() {\n      return this.user.userID === this.groupLiveInfo.anchorID;\n    }\n  }),\n  components: {\n    liveGift: liveGift,\n    ElTooltip: _Tooltip\n  },\n  created: function created() {\n    var _this = this;\n\n    // 此处监听，防止观众侧派发加群事件时，该组件中还未注册监听\n    this.$bus.$on('join-group-live-avchatroom', function () {\n      _this.joinGroupLiveAvChatRoom();\n    });\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n\n    this.$bus.$on('group-live-send-gift', function (index) {\n      var message = _this2.tim.createCustomMessage({\n        to: _this2.groupLiveInfo.roomID,\n        conversationType: _this2.TIM.TYPES.CONV_GROUP,\n        payload: {\n          data: JSON.stringify({\n            version: '1.0.0',\n            'message': \"\".concat(index),\n            'command': '6',\n            'action': 301\n          }),\n          description: '',\n          extension: ''\n        }\n      }); // 此处用JSON序列化和反序列化对message断链\n\n\n      _this2.$store.commit('pushAvChatRoomMessageList', JSON.parse(JSON.stringify(message)));\n\n      _this2.tim.sendMessage(message).catch(function (error) {\n        _this2.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        });\n      });\n    });\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.$bus.$off('join-group-live-avchatroom');\n    this.$bus.$off('group-live-send-gift');\n\n    if (!this.isAnchor && this.groupLiveInfo.isNeededQuitRoom === 1) {\n      this.quitGroupLiveAvChatRoom();\n    }\n\n    this.$store.commit('updateGroupLiveInfo', {\n      isNeededQuitRoom: 0\n    });\n  },\n  methods: {\n    getAvatar: function getAvatar(item) {\n      if (item.from === this.user.userID) {\n        return this.user.currentUserProfile.avatar || this.defaultAvatar;\n      }\n\n      return item.avatar || this.defaultAvatar;\n    },\n    getNick: function getNick(item) {\n      if (item.from === this.user.userID) {\n        return this.user.currentUserProfile.nick || item.from;\n      }\n\n      return item.nick || item.from;\n    },\n    // 进入直播互动群\n    joinGroupLiveAvChatRoom: function joinGroupLiveAvChatRoom() {\n      var _this3 = this;\n\n      this.tim.joinGroup({\n        groupID: this.groupLiveInfo.roomID\n      }).then(function (imResponse) {\n        var status = imResponse.data.status;\n\n        if (status === _this3.TIM.TYPES.JOIN_STATUS_SUCCESS || status === _this3.TIM.TYPES.JOIN_STATUS_ALREADY_IN_GROUP) {\n          _this3.sendAvailable = true;\n        }\n      }).catch(function () {});\n    },\n    // 退出直播互动群\n    quitGroupLiveAvChatRoom: function quitGroupLiveAvChatRoom() {\n      this.tim.quitGroup(this.groupLiveInfo.roomID).then(function () {}).catch(function () {});\n    },\n    sendMessage: function sendMessage() {\n      var _this4 = this;\n\n      if (!this.sendAvailable) {\n        this.$store.commit('showMessage', {\n          message: '开始直播后可以互动聊天哦！',\n          type: 'warning'\n        });\n        return;\n      }\n\n      if (this.messageContent === '' || this.messageContent.trim().length === 0) {\n        this.messageContent = '';\n        this.$store.commit('showMessage', {\n          message: '不能发送空消息哦！',\n          type: 'info'\n        });\n        return;\n      }\n\n      var message = this.tim.createTextMessage({\n        to: this.groupLiveInfo.roomID,\n        conversationType: this.TIM.TYPES.CONV_GROUP,\n        payload: {\n          text: this.messageContent\n        }\n      }); // 此处用JSON序列化和反序列化对message断链\n\n      this.$store.commit('pushAvChatRoomMessageList', JSON.parse(JSON.stringify(message)));\n      this.tim.sendMessage(message).catch(function (error) {\n        _this4.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        });\n      });\n      this.messageContent = '';\n    }\n  },\n  watch: {\n    avChatRoomMessageList: function avChatRoomMessageList() {\n      var _this5 = this;\n\n      this.$nextTick(function () {\n        var messageListNode = _this5.$refs['message-list'];\n\n        if (!messageListNode) {\n          return;\n        }\n\n        messageListNode.scrollTop = messageListNode.scrollHeight;\n      });\n    }\n  }\n};",null]}