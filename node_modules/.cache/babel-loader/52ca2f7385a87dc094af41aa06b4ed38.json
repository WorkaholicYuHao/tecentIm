{"remainingRequest":"/Users/yuhao/TIMSDK/H5/node_modules/thread-loader/dist/cjs.js!/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js!/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuhao/TIMSDK/H5/src/components/message/message-elements/sound-element.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuhao/TIMSDK/H5/src/components/message/message-elements/sound-element.vue","mtime":1616982605603},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\nimport MessageBubble from \"../message-bubble\";\nexport default {\n  name: 'SoundElement',\n  props: {\n    payload: {\n      type: Object,\n      required: true\n    },\n    message: {\n      type: Object,\n      required: true\n    },\n    isMine: {\n      type: Boolean\n    }\n  },\n  components: {\n    MessageBubble: MessageBubble\n  },\n  data: function data() {\n    return {\n      amr: null\n    };\n  },\n  computed: {\n    url: function url() {\n      return this.payload.url;\n    },\n    size: function size() {\n      return this.payload.size;\n    },\n    second: function second() {\n      return this.payload.second;\n    }\n  },\n  methods: {\n    play: function play() {\n      // 目前移动端的语音消息采用 aac 格式，以前用 amr 格式。默认先用 audio 标签播放，若无法播放则尝试 amr 格式播放。\n      var audio = document.createElement('audio');\n      audio.addEventListener('error', this.tryPlayAMR); // 播放出错，则尝试使用 AMR 播放\n\n      audio.src = this.url;\n      var promise = audio.play();\n\n      if (promise) {\n        promise.catch(function () {});\n      }\n    },\n    tryPlayAMR: function tryPlayAMR() {\n      try {\n        var isIE = /MSIE|Trident|Edge/.test(window.navigator.userAgent); // amr 播放组件库在 IE 不支持\n\n        if (isIE) {\n          this.$store.commit('showMessage', {\n            message: '您的浏览器不支持该格式的语音消息播放，请尝试更换浏览器，建议使用：谷歌浏览器',\n            type: 'warning'\n          });\n          return;\n        } // 动态插入 amr 播放组件库\n\n\n        if (!window.BenzAMRRecorder) {\n          var script = document.createElement('script');\n          script.addEventListener('load', this.playAMR);\n          script.src = './BenzAMRRecorder.js';\n          var firstScript = document.getElementsByTagName('script')[0];\n          firstScript.parentNode.insertBefore(script, firstScript);\n          return;\n        }\n\n        this.playAMR();\n      } catch (error) {\n        this.$store.commit('showMessage', {\n          message: '您的浏览器不支持该格式的语音消息播放，请尝试更换浏览器，建议使用：谷歌浏览器',\n          type: 'warning'\n        });\n      }\n    },\n    playAMR: function playAMR() {\n      var _this = this;\n\n      if (!this.amr && window.BenzAMRRecorder) {\n        this.amr = new window.BenzAMRRecorder();\n      }\n\n      if (this.amr.isInit()) {\n        this.amr.play();\n        return;\n      }\n\n      this.amr.initWithUrl(this.url).then(function () {\n        _this.amr.play();\n      });\n    }\n  }\n};",null]}