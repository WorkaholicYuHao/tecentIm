{"remainingRequest":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js!/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuhao/TIMSDK/H5/src/components/message/message-bubble.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuhao/TIMSDK/H5/src/components/message/message-bubble.vue","mtime":1616982605602},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuhao/TIMSDK/H5/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: 'MessageBubble',\n  data: function data() {\n    return {\n      isTimeout: false\n    };\n  },\n  props: {\n    isMine: {\n      type: Boolean\n    },\n    isNew: {\n      type: Boolean\n    },\n    message: {\n      type: Object,\n      required: true\n    }\n  },\n  created: function created() {\n    this.isTimeoutHandler();\n  },\n  mounted: function mounted() {\n    if (this.$refs.dropdown && this.$refs.dropdown.$el) {\n      this.$refs.dropdown.$el.addEventListener('mousedown', this.handleDropDownMousedown);\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (this.$refs.dropdown && this.$refs.dropdown.$el) {\n      this.$refs.dropdown.$el.removeEventListener('mousedown', this.handleDropDownMousedown);\n    }\n  },\n  computed: {\n    bubbleStyle: function bubbleStyle() {\n      var classString = '';\n\n      if (this.isMine) {\n        classString += 'message-send';\n      } else {\n        classString += 'message-received';\n      }\n\n      if (this.isNew) {\n        classString += 'new';\n      }\n\n      return classString;\n    },\n    text: function text() {\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && !this.isMine) {\n        return '对方撤回了一条消息';\n      }\n\n      if (this.message.conversationType === this.TIM.TYPES.CONV_GROUP && !this.isMine) {\n        return \"\".concat(this.message.from, \"\\u64A4\\u56DE\\u4E86\\u4E00\\u6761\\u6D88\\u606F\");\n      }\n\n      return '你撤回了一条消息';\n    },\n    messageReadByPeer: function messageReadByPeer() {\n      if (this.message.status !== 'success') {\n        return false;\n      }\n\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && this.message.isPeerRead) {\n        return '已读';\n      }\n\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && !this.message.isPeerRead) {\n        return '未读';\n      }\n\n      return '';\n    },\n    isEdit: function isEdit() {\n      if (!this.isMine) {\n        return false;\n      }\n\n      if (this.message.type !== this.TIM.TYPES.MSG_TEXT) {\n        return false;\n      }\n\n      if (this.isTimeout) {\n        return false;\n      }\n\n      return true;\n    }\n  },\n  methods: {\n    handleDropDownMousedown: function handleDropDownMousedown(e) {\n      if (!this.isMine || this.isTimeout) {\n        return;\n      }\n\n      if (e.buttons === 2) {\n        if (this.$refs.dropdown.visible) {\n          this.$refs.dropdown.hide();\n        } else {\n          this.$refs.dropdown.show();\n        }\n      }\n    },\n    handleCommand: function handleCommand(command) {\n      var _this = this;\n\n      switch (command) {\n        case 'revoke':\n          this.tim.revokeMessage(this.message).then(function () {\n            _this.isTimeoutHandler();\n          }).catch(function (err) {\n            _this.$store.commit('showMessage', {\n              message: err,\n              type: 'warning'\n            });\n          });\n          break;\n\n        case 'delete':\n          break;\n\n        default:\n          break;\n      }\n    },\n    isTimeoutHandler: function isTimeoutHandler() {\n      // 从发送消息时间开始算起，两分钟内可以编辑\n      var now = new Date();\n\n      if (parseInt(now.getTime() / 1000) - this.message.time > 2 * 60) {\n        this.isTimeout = true;\n        return;\n      }\n\n      setTimeout(this.isTimeoutHandler, 1000);\n    },\n    reEdit: function reEdit() {\n      this.$bus.$emit('reEditMessage', this.message.payload.text);\n    }\n  }\n};",{"version":3,"sources":["message-bubble.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"chat-bubble\" @mousedown.stop @contextmenu.prevent>\n    <el-dropdown trigger=\"\" ref=\"dropdown\" v-if=\"!message.isRevoked\" @command=\"handleCommand\">\n      <div style=\"display: flex\">\n        <div v-if=\"isMine && messageReadByPeer\" class=\"message-status\">\n          <span>{{messageReadByPeer}}</span>\n        </div>\n        <div class=\"message-content\" :class=\"bubbleStyle\">\n          <slot></slot>\n        </div>\n      </div>\n      <el-dropdown-menu slot=\"dropdown\">\n        <el-dropdown-item command=\"revoke\" v-if=\"isMine\">撤回</el-dropdown-item>\n        <!-- <el-dropdown-item command=\"delete\">删除</el-dropdown-item> -->\n      </el-dropdown-menu>\n    </el-dropdown>\n    <div class=\"group-tip-element-wrapper\" v-if=\"message.isRevoked\">\n      {{text}}\n      <el-button type=\"text\" size=\"mini\" class=\"edit-button\" v-show=\"isEdit\" @click=\"reEdit\">&nbsp;重新编辑</el-button>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'MessageBubble',\n  data() {\n    return {\n      isTimeout: false\n    }\n  },\n  props: {\n    isMine: {\n      type: Boolean\n    },\n    isNew: {\n      type: Boolean\n    },\n    message: {\n      type: Object,\n      required: true\n    }\n  },\n  created() {\n    this.isTimeoutHandler()\n  },\n  mounted() {\n    if (this.$refs.dropdown && this.$refs.dropdown.$el) {\n      this.$refs.dropdown.$el.addEventListener('mousedown', this.handleDropDownMousedown)\n    }\n  },\n  beforeDestroy() {\n    if (this.$refs.dropdown && this.$refs.dropdown.$el) {\n      this.$refs.dropdown.$el.removeEventListener('mousedown', this.handleDropDownMousedown)\n    }\n  },\n  computed: {\n    bubbleStyle() {\n      let classString = ''\n      if (this.isMine) {\n        classString += 'message-send'\n      } else {\n        classString += 'message-received'\n      }\n      if (this.isNew) {\n        classString += 'new'\n      }\n      return classString\n    },\n    text() {\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && !this.isMine) {\n        return '对方撤回了一条消息'\n      }\n      if (this.message.conversationType === this.TIM.TYPES.CONV_GROUP && !this.isMine) {\n        return `${this.message.from}撤回了一条消息`\n      }\n      return '你撤回了一条消息'\n    },\n    messageReadByPeer() {\n      if (this.message.status !== 'success') {\n        return false\n      }\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && this.message.isPeerRead) {\n        return '已读'\n      }\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && !this.message.isPeerRead) {\n        return '未读'\n      }\n      return ''\n    },\n    isEdit() {\n      if (!this.isMine) {\n        return false\n      }\n      if (this.message.type !== this.TIM.TYPES.MSG_TEXT) {\n        return false\n      }\n      if (this.isTimeout) {\n        return false\n      }\n      return true\n    },\n  },\n  methods: {\n    handleDropDownMousedown(e) {\n      if (!this.isMine || this.isTimeout) {\n        return\n      }\n      if (e.buttons === 2) {\n        if (this.$refs.dropdown.visible) {\n          this.$refs.dropdown.hide()\n        } else {\n          this.$refs.dropdown.show()\n        }\n      }\n    },\n    handleCommand(command) {\n      switch (command) {\n        case 'revoke':\n          this.tim.revokeMessage(this.message).then(() => {\n            this.isTimeoutHandler()\n          }).catch((err) => {\n            this.$store.commit('showMessage', {\n              message: err,\n              type: 'warning'\n            })\n          })\n          break\n        case 'delete':\n          break\n        default:\n          break\n      }\n    },\n    isTimeoutHandler() { // 从发送消息时间开始算起，两分钟内可以编辑\n      let now = new Date()\n      if (parseInt(now.getTime() / 1000) - this.message.time > 2 * 60) {\n        this.isTimeout = true\n        return\n      }\n      setTimeout(this.isTimeoutHandler, 1000)\n    },\n    reEdit() {\n      this.$bus.$emit('reEditMessage', this.message.payload.text)\n    }\n  }\n}\n</script>\n\n<style lang=\"stylus\" scoped>\n.chat-bubble\n  position relative\n  .message-status\n    display: flex;\n    min-width: 25px;\n    margin-right: 10px;\n    justify-content: center;\n    align-items: center;\n    font-size: 12px;\n    color: #6e7981;\n  .message-content\n    outline: none\n    font-size 14px\n    position relative\n    max-width 350px\n    word-wrap break-word\n    word-break break-all\n    padding 10px\n    box-shadow: 0 5px 10px 0 rgba(0,0,0,.1);\n    span\n      white-space pre-wrap\n      margin 0\n      text-shadow $regular 0 0 0.05em\n    img\n      vertical-align bottom\n    &::before\n      position: absolute\n      top: 0\n      width: 12px\n      height: 40px\n      content \"\\e900\"\n      // content \"\\e906\"\n      font-family 'tim' !important\n      font-size 24px // 32px 在mac上会模糊 24px正常 , window 24px模糊 28px 32px正常  36px windows mac 基本一致，但是太大\n  .message-received\n    background-color $white\n    margin-left 15px\n    border-radius 0 4px 4px 4px\n    &::before\n      left -10px\n      transform scaleX(-1)\n      color $white\n    &.new\n      transform: scale(0);\n      transform-origin: top left;\n      animation: bounce 500ms linear both;\n  .message-send\n    background-color $light-primary\n    margin-right 15px\n    border-radius 4px 0 4px 4px\n    color $white\n    &::before\n      right: -10px\n      color $light-primary\n    &.new\n      transform: scale(0);\n      transform-origin: top right;\n      animation: bounce 500ms linear both;\n  .el-dropdown {\n    vertical-align: top;\n    display flex\n  }\n  .el-dropdown + .el-dropdown {\n    margin-left: 15px;\n  }\n  .el-icon-arrow-down {\n    font-size: 12px;\n  }\n.group-tip-element-wrapper\n  background $white\n  padding 4px 15px\n  border-radius 3px\n  color $secondary\n  font-size 12px\n  // text-shadow $secondary 0 0 0.05em\n.edit-button\n  padding-top 4px\n  height 20px\n  font-size 10px\n@keyframes bounce {\n  0% { transform: matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  4.7% { transform: matrix3d(0.45, 0, 0, 0, 0, 0.45, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  9.41% { transform: matrix3d(0.883, 0, 0, 0, 0, 0.883, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  14.11% { transform: matrix3d(1.141, 0, 0, 0, 0, 1.141, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  18.72% { transform: matrix3d(1.212, 0, 0, 0, 0, 1.212, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  24.32% { transform: matrix3d(1.151, 0, 0, 0, 0, 1.151, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  29.93% { transform: matrix3d(1.048, 0, 0, 0, 0, 1.048, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  35.54% { transform: matrix3d(0.979, 0, 0, 0, 0, 0.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  41.04% { transform: matrix3d(0.961, 0, 0, 0, 0, 0.961, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  52.15% { transform: matrix3d(0.991, 0, 0, 0, 0, 0.991, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  63.26% { transform: matrix3d(1.007, 0, 0, 0, 0, 1.007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  85.49% { transform: matrix3d(0.999, 0, 0, 0, 0, 0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  100% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n}\n</style>\n"],"sourceRoot":"src/components/message"}]}